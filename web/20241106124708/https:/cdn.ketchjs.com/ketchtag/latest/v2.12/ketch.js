var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

/*! For license information please see ketch.js.LICENSE.txt */
(()=>{var e={7007:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,o=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,o){function i(n){e.removeListener(t,r),o(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}_(e,t,r,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&_(e,"error",t,{once:!0})}(e,i)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function u(e,t,n,o){var i,r,s,u;if(a(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),s=r[t]),void 0===s)s=r[t]=n,++e._eventsCount;else if("function"==typeof s?s=r[t]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),(i=c(e))>0&&s.length>i&&!s.warned){s.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=s.length,u=d,console&&console.warn&&console.warn(u)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(o);return i.listener=n,o.wrapFn=i,i}function f(e,t,n){var o=e._events;if(void 0===o)return[];var i=o[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):h(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}function _(e,t,n,o){if("function"==typeof e.on)o.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(r){o.once&&e.removeEventListener(t,i),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=h(c,u);for(n=0;n<u;++n)o(d[n],this,t)}return!0},r.prototype.addListener=function(e,t){return u(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return u(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,o,i,r,s;if(a(t),void 0===(o=this._events))return this;if(void 0===(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){s=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(o[e]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,r=Object.keys(n);for(o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},r.prototype.listeners=function(e){return f(this,e,!0)},r.prototype.rawListeners=function(e){return f(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},r.prototype.listenerCount=p,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},9207:e=>{function t(e){var t=typeof e;return"object"===t?null===e?"null":function(e){if(Array.isArray(e))return!0;var t=e.length;return"number"==typeof t&&t>-1&&(!t||0 in e&&t-1 in e)}(e)?"array":e.constructor===Object?"pure-object":"object":t}e.exports=function e(n,o){if(n===o)return!0;if(n!=n&&o!=o)return!0;var i=t(n);if(i!==t(o))return!1;if("pure-object"===i){if(n===o)return!0;var r=Object.keys(n),s=Object.keys(o).length;if(r.length!==s)return!1;for(var a=0,c=r.length;a<c;a++){var u=r[a];if(!o.hasOwnProperty(r[a]))return!1;var d=n[u],l=o[u];if(d===n||l===o||d===o||l===n)return d===l;if(!e(d,l))return!1}return!0}if("array"===i){if(n.length!==o.length)return!1;for(var f=0;f<n.length;f++){var p=n[f],h=o[f];if(p===n||h===o||p===o||h===n)return p===h;if(!e(p,h))return!1}return!0}if("object"===i){if(n.valueOf!==Object.prototype.valueOf()&&o.valueOf!==Object.prototype.valueOf())return n.valueOf()===o.valueOf();if(n.toString!==Object.prototype.toString()&&o.toString!==Object.prototype.toString())return n.toString()===o.toString()}return!1}},7458:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=(0,n(5305).getLogger)("appDivs");t.default=function(e){var t,n,r;return o.__awaiter(this,void 0,void 0,(function*(){const o=yield e.getConfig();let s=[];i.debug("init",null===(t=o.options)||void 0===t?void 0:t.appDivs);const a=null===(r=null===(n=o.options)||void 0===n?void 0:n.appDivs)||void 0===r?void 0:r.trim();if(null==a?void 0:a.length){const t=a.split(",");e.on("willShowExperience",(()=>{i.debug("willShowExperience");for(const e of t){const t=document.getElementById(e);t&&(i.debug("obscuring",e),s.push({id:e,zIndex:t.style.zIndex}),t.style.zIndex="-1")}})),e.on("hideExperience",(()=>{i.debug("hideExperience");for(const e of s){const t=document.getElementById(e.id);t&&(i.debug("restoring",t.id),t.style.zIndex=e.zIndex)}s=[]}))}}))}},6865:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=(0,n(5305).getLogger)("dataLayer");function r(){return window.dataLayer=window.dataLayer||[]}t.default=function(e){return o.__awaiter(this,void 0,void 0,(function*(){e.on("geoip",(e=>{i.info("pushGeoIP",e);const t={event:"ketchGeoip",ip:e.ip,countryCode:e.countryCode,regionCode:e.regionCode};r().push(t)})),e.on("jurisdiction",(e=>{i.info("pushJurisdiction",e);const t={event:"ketchJurisdiction",jurisdictionCode:e};r().push(t)}))}))}},5307:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=o.__importDefault(n(7458)),r=o.__importDefault(n(6865)),s=n(5305),a=n(8163),c=(0,s.getLogger)("ketch");t.default=function(e){return o.__awaiter(this,void 0,void 0,(function*(){return c.info(`version ${a.version}`),Promise.all([(0,i.default)(e),(0,r.default)(e)]).then((()=>{}))}))}},2831:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return c.default}});var o=f(n(3518)),i=f(n(4948)),r=f(n(5073)),s=f(n(7186)),a=f(n(4808)),c=f(n(7775)),u=f(n(7037)),d=f(n(9910)),l=f(n(6792));function f(e){return e&&e.__esModule?e:{default:e}}},2311:(e,t)=>{"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function o(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,r,s){return o((a=o(o(t,e),o(i,s)))<<(c=r)|a>>>32-c,n);var a,c}function r(e,t,n,o,r,s,a){return i(t&n|~t&o,e,t,r,s,a)}function s(e,t,n,o,r,s,a){return i(t&o|n&~o,e,t,r,s,a)}function a(e,t,n,o,r,s,a){return i(t^n^o,e,t,r,s,a)}function c(e,t,n,o,r,s,a){return i(n^(t|~o),e,t,r,s,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){const t=[],n=32*e.length,o="0123456789abcdef";for(let i=0;i<n;i+=8){const n=e[i>>5]>>>i%32&255,r=parseInt(o.charAt(n>>>4&15)+o.charAt(15&n),16);t.push(r)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;let i=1732584193,u=-271733879,d=-1732584194,l=271733878;for(let t=0;t<e.length;t+=16){const n=i,f=u,p=d,h=l;i=r(i,u,d,l,e[t],7,-680876936),l=r(l,i,u,d,e[t+1],12,-389564586),d=r(d,l,i,u,e[t+2],17,606105819),u=r(u,d,l,i,e[t+3],22,-1044525330),i=r(i,u,d,l,e[t+4],7,-176418897),l=r(l,i,u,d,e[t+5],12,1200080426),d=r(d,l,i,u,e[t+6],17,-1473231341),u=r(u,d,l,i,e[t+7],22,-45705983),i=r(i,u,d,l,e[t+8],7,1770035416),l=r(l,i,u,d,e[t+9],12,-1958414417),d=r(d,l,i,u,e[t+10],17,-42063),u=r(u,d,l,i,e[t+11],22,-1990404162),i=r(i,u,d,l,e[t+12],7,1804603682),l=r(l,i,u,d,e[t+13],12,-40341101),d=r(d,l,i,u,e[t+14],17,-1502002290),u=r(u,d,l,i,e[t+15],22,1236535329),i=s(i,u,d,l,e[t+1],5,-165796510),l=s(l,i,u,d,e[t+6],9,-1069501632),d=s(d,l,i,u,e[t+11],14,643717713),u=s(u,d,l,i,e[t],20,-373897302),i=s(i,u,d,l,e[t+5],5,-701558691),l=s(l,i,u,d,e[t+10],9,38016083),d=s(d,l,i,u,e[t+15],14,-660478335),u=s(u,d,l,i,e[t+4],20,-405537848),i=s(i,u,d,l,e[t+9],5,568446438),l=s(l,i,u,d,e[t+14],9,-1019803690),d=s(d,l,i,u,e[t+3],14,-187363961),u=s(u,d,l,i,e[t+8],20,1163531501),i=s(i,u,d,l,e[t+13],5,-1444681467),l=s(l,i,u,d,e[t+2],9,-51403784),d=s(d,l,i,u,e[t+7],14,1735328473),u=s(u,d,l,i,e[t+12],20,-1926607734),i=a(i,u,d,l,e[t+5],4,-378558),l=a(l,i,u,d,e[t+8],11,-2022574463),d=a(d,l,i,u,e[t+11],16,1839030562),u=a(u,d,l,i,e[t+14],23,-35309556),i=a(i,u,d,l,e[t+1],4,-1530992060),l=a(l,i,u,d,e[t+4],11,1272893353),d=a(d,l,i,u,e[t+7],16,-155497632),u=a(u,d,l,i,e[t+10],23,-1094730640),i=a(i,u,d,l,e[t+13],4,681279174),l=a(l,i,u,d,e[t],11,-358537222),d=a(d,l,i,u,e[t+3],16,-722521979),u=a(u,d,l,i,e[t+6],23,76029189),i=a(i,u,d,l,e[t+9],4,-640364487),l=a(l,i,u,d,e[t+12],11,-421815835),d=a(d,l,i,u,e[t+15],16,530742520),u=a(u,d,l,i,e[t+2],23,-995338651),i=c(i,u,d,l,e[t],6,-198630844),l=c(l,i,u,d,e[t+7],10,1126891415),d=c(d,l,i,u,e[t+14],15,-1416354905),u=c(u,d,l,i,e[t+5],21,-57434055),i=c(i,u,d,l,e[t+12],6,1700485571),l=c(l,i,u,d,e[t+3],10,-1894986606),d=c(d,l,i,u,e[t+10],15,-1051523),u=c(u,d,l,i,e[t+1],21,-2054922799),i=c(i,u,d,l,e[t+8],6,1873313359),l=c(l,i,u,d,e[t+15],10,-30611744),d=c(d,l,i,u,e[t+6],15,-1560198380),u=c(u,d,l,i,e[t+13],21,1309151649),i=c(i,u,d,l,e[t+4],6,-145523070),l=c(l,i,u,d,e[t+11],10,-1120210379),d=c(d,l,i,u,e[t+2],15,718787259),u=c(u,d,l,i,e[t+9],21,-343485551),i=o(i,n),u=o(u,f),d=o(d,p),l=o(l,h)}return[i,u,d,l]}(function(e){if(0===e.length)return[];const t=8*e.length,o=new Uint32Array(n(t));for(let n=0;n<t;n+=8)o[n>>5]|=(255&e[n/8])<<n%32;return o}(e),8*e.length))}},6140:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=n},4808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},6792:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=(o=n(7037))&&o.__esModule?o:{default:o};t.default=function(e){if(!(0,i.default)(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}},7656:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},2858:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)};const o=new Uint8Array(16)},9042:(e,t)=>{"use strict";function n(e,t,n,o){switch(e){case 0:return t&n^~t&o;case 1:case 3:return t^n^o;case 2:return t&n^t&o^n&o}}function o(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const r=e.length/4+2,s=Math.ceil(r/16),a=new Array(s);for(let t=0;t<s;++t){const n=new Uint32Array(16);for(let o=0;o<16;++o)n[o]=e[64*t+4*o]<<24|e[64*t+4*o+1]<<16|e[64*t+4*o+2]<<8|e[64*t+4*o+3];a[t]=n}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const r=new Uint32Array(80);for(let t=0;t<16;++t)r[t]=a[e][t];for(let e=16;e<80;++e)r[e]=o(r[e-3]^r[e-8]^r[e-14]^r[e-16],1);let s=i[0],c=i[1],u=i[2],d=i[3],l=i[4];for(let e=0;e<80;++e){const i=Math.floor(e/20),a=o(s,5)+n(i,c,u,d)+l+t[i]+r[e]>>>0;l=d,d=u,u=o(c,30)>>>0,c=s,s=a}i[0]=i[0]+s>>>0,i[1]=i[1]+c>>>0,i[2]=i[2]+u>>>0,i[3]=i[3]+d>>>0,i[4]=i[4]+l>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]}},9910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=s;var o,i=(o=n(7037))&&o.__esModule?o:{default:o};const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));function s(e,t=0){return r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]}t.default=function(e,t=0){const n=s(e,t);if(!(0,i.default)(n))throw TypeError("Stringified UUID is invalid");return n}},3518:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=(o=n(2858))&&o.__esModule?o:{default:o},r=n(9910);let s,a,c=0,u=0;t.default=function(e,t,n){let o=t&&n||0;const d=t||new Array(16);let l=(e=e||{}).node||s,f=void 0!==e.clockseq?e.clockseq:a;if(null==l||null==f){const t=e.random||(e.rng||i.default)();null==l&&(l=s=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==f&&(f=a=16383&(t[6]<<8|t[7]))}let p=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:u+1;const _=p-c+(h-u)/1e4;if(_<0&&void 0===e.clockseq&&(f=f+1&16383),(_<0||p>c)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,u=h,a=f,p+=122192928e5;const g=(1e4*(268435455&p)+h)%4294967296;d[o++]=g>>>24&255,d[o++]=g>>>16&255,d[o++]=g>>>8&255,d[o++]=255&g;const v=p/4294967296*1e4&268435455;d[o++]=v>>>8&255,d[o++]=255&v,d[o++]=v>>>24&15|16,d[o++]=v>>>16&255,d[o++]=f>>>8|128,d[o++]=255&f;for(let e=0;e<6;++e)d[o+e]=l[e];return t||(0,r.unsafeStringify)(d)}},4948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(9025)),i=r(n(2311));function r(e){return e&&e.__esModule?e:{default:e}}var s=(0,o.default)("v3",48,i.default);t.default=s},9025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,n){function o(e,o,s,a){var c;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof o&&(o=(0,r.default)(o)),16!==(null===(c=o)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+e.length);if(u.set(o),u.set(e,o.length),u=n(u),u[6]=15&u[6]|t,u[8]=63&u[8]|128,s){a=a||0;for(let e=0;e<16;++e)s[a+e]=u[e];return s}return(0,i.unsafeStringify)(u)}try{o.name=e}catch(e){}return o.DNS=s,o.URL=a,o};var o,i=n(9910),r=(o=n(6792))&&o.__esModule?o:{default:o};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=a},5073:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(6140)),i=s(n(2858)),r=n(9910);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,n){if(o.default.randomUUID&&!t&&!e)return o.default.randomUUID();const s=(e=e||{}).random||(e.rng||i.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=s[e];return t}return(0,r.unsafeStringify)(s)}},7186:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(9025)),i=r(n(9042));function r(e){return e&&e.__esModule?e:{default:e}}var s=(0,o.default)("v5",80,i.default);t.default=s},7037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=(o=n(7656))&&o.__esModule?o:{default:o};t.default=function(e){return"string"==typeof e&&i.default.test(e)}},7775:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=(o=n(7037))&&o.__esModule?o:{default:o};t.default=function(e){if(!(0,i.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},8138:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Future=void 0;const o=n(1635),i=n(7007),r=o.__importDefault(n(9207));class s{constructor(e={}){this._options=e,this._value=void 0,this._error=void 0,this._emitter=new i.EventEmitter,e.maxListeners&&this.setMaxListeners(e.maxListeners),e.executor&&this.fulfill(e.executor),this._options.timeout?this._timeout=window.setTimeout((()=>{void 0===this._value&&void 0===this._error&&(this.error=new Error("timed out"))}),this._options.timeout):this._timeout=void 0}static resolve(e){return(new s).fulfill(e)}fulfill(e){return function(e){return"function"==typeof e}(e)?new Promise(e).then((e=>this.value=e)).catch((e=>this.error=e)):this.value=e,this}isFulfilled(){return void 0!==this._value}get fulfilled(){return void 0!==this._value?Promise.resolve(this._value):new Promise(((e,t)=>{this.once(s.FULFILLED,e),this.once(s.ERROR,t)}))}get value(){if(void 0!==this._error)throw this._error;if(void 0===this._value)throw new Error("future has not been resolved");return this._value}set value(e){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=void 0),this._error=void 0,void 0!==this._value&&(0,r.default)(this._value,e)||(this._value=e,this._emitter.emit(s.FULFILLED,e),this._options.name&&this._options.emitter&&this._options.emitter.emit(this._options.name,e))}reset(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=void 0);const e=this._value;this._value=void 0,this._error=void 0,this._emitter.emit(s.RESET,e),this._options.name&&this._options.emitter&&this._options.emitter.emit(this._options.name,void 0)}get error(){return this._error}set error(e){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=void 0),this._error=e,this._value=void 0,void 0!==e&&this._emitter.emit(s.ERROR,e)}addListener(e,t){return this._emitter.addListener(e,t),this.trigger(e,t),this}on(e,t){return this.addListener(e,t)}once(e,t){return this.trigger(e,t)||this._emitter.once(e,t),this}removeListener(e,t){return this._emitter.removeListener(e,t),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return this._emitter.removeAllListeners(e),this}setMaxListeners(e){return this._emitter.setMaxListeners(e),this}then(e,t){return this.fulfilled.then(e,t)}catch(e){return this.fulfilled.catch(e)}trigger(e,t){return e===s.FULFILLED&&this.isFulfilled()?(t(this._value),!0):e===s.ERROR&&void 0!==this._error&&(t(this._error),!0)}}s.FULFILLED="fulfilled",s.RESET="reset",s.ERROR="error",t.Future=s,t.default=s},4925:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(835),r=n(2991);t.default=class{constructor(e=window,t=r.DEFAULT_TTL){this._window=e,this._ttl=t}getItem(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=(0,i.getCookie)(this._window,e);if(t)try{return JSON.parse(atob(t))}catch(e){return}}))}setItem(e,t){return o.__awaiter(this,void 0,void 0,(function*(){return!!(0,i.setCookie)(this._window,e,btoa(JSON.stringify(t)),this._ttl)&&this.getItem(e).then((e=>!!e))}))}removeItem(e){return o.__awaiter(this,void 0,void 0,(function*(){return(0,i.setCookie)(this._window,e,"",-86400),this.getItem(e).then((e=>!e))}))}}},9791:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetaCacher=t.WebStorageCacher=t.CookieCacher=t.getDefaultCacher=void 0;const o=n(1635),i=o.__importDefault(n(4925));t.CookieCacher=i.default;const r=o.__importDefault(n(2644));t.WebStorageCacher=r.default;const s=o.__importDefault(n(3842));t.MetaCacher=s.default;const a=n(2991);t.getDefaultCacher=function(e={}){var t,n;const o=null!==(t=e.window)&&void 0!==t?t:window,c=null!==(n=e.ttl)&&void 0!==n?n:a.DEFAULT_TTL;return new s.default(new i.default(o,c),new r.default(o.localStorage,c),new r.default(o.sessionStorage,c))}},3842:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635);t.default=class{constructor(...e){this._cachers=e}getItem(e){return o.__awaiter(this,void 0,void 0,(function*(){for(const t of this._cachers){const n=yield t.getItem(e);if(n)return n}}))}setItem(e,t){return o.__awaiter(this,void 0,void 0,(function*(){for(const n of this._cachers)if(yield n.setItem(e,t))return!0;return!1}))}removeItem(e){return o.__awaiter(this,void 0,void 0,(function*(){for(const t of this._cachers)if(yield t.removeItem(e))return!0;return!1}))}}},2991:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_TTL=void 0,t.DEFAULT_TTL=604800},2644:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(2991);t.default=class{constructor(e=window.localStorage,t=i.DEFAULT_TTL){this._storage=e,this._ttl=t}getItem(e){return o.__awaiter(this,void 0,void 0,(function*(){try{const n=function(e,t){const n=e.getItem(`${t}_metadata`);if(n)return JSON.parse(atob(n))}(this._storage,e);if(!(n&&(t=n,t.iat<=Math.floor(Date.now()/1e3))))return;if(function(e){return e.exp<Math.floor(Date.now()/1e3)}(n))return void(yield this.removeItem(e));const o=this._storage.getItem(e);return o?JSON.parse(atob(o)):void 0}catch(e){return}var t}))}setItem(e,t){return o.__awaiter(this,void 0,void 0,(function*(){try{!function(e,t,n){e.setItem(`${t}_metadata`,btoa(JSON.stringify(n)))}(this._storage,e,function(e){const t=Math.floor(Date.now()/1e3);return{iat:t,exp:t+e}}(this._ttl));const n=btoa(JSON.stringify(t));return this._storage.setItem(e,n),n===this._storage.getItem(e)}catch(e){return!1}}))}removeItem(e){return o.__awaiter(this,void 0,void 0,(function*(){try{return function(e,t){e.removeItem(t)}(this._storage,e),this._storage.removeItem(e),!this._storage.getItem(e)}catch(e){return!1}}))}}},835:(e,t)=>{"use strict";function n(e,t){return e.document.cookie.split("; ").reduce(((e,n)=>{const o=n.split("=");return o[0]===t?decodeURIComponent(o[1]):e}),"")}Object.defineProperty(t,"__esModule",{value:!0}),t.setCookie=t.getCookie=void 0,t.getCookie=n,t.setCookie=function(e,t,o,i){const r=e.document.location.hostname.split("."),s=[`${t}=${encodeURIComponent(o)}`,"path=/","SameSite=None","Secure"];if(i){const e=new Date(Date.now()+1e3*i).toUTCString();s.push(`expires=${e}`)}const a=s.join("; ");for(let i=2;i<=r.length;i++)if(e.document.cookie=`${a}; domain=${r.slice(-1*i).join(".")}`,n(e,t)===o)return!0;return e.document.cookie=a,!!n(e,t)}},7520:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.host=t.Host=void 0;const o=n(1635),i=n(7007),r=n(6410),s=n(8251);class a{constructor(e){this._origin=new URL(e).origin,this._events=new i.EventEmitter,this._rpc=new Map,addEventListener(r.MessageEvent,(0,s.makeListener)(this._events,this._origin)),this.on(r.RpcCall,((e,t,...n)=>o.__awaiter(this,void 0,void 0,(function*(){const o=this._rpc.get(e);this.emit(`rpcResult:${t}`,o?yield o(...n):new Error(`unimplemented: ${e}`))}))))}rpc(e,t){this._rpc.set(e,t)}on(e,t){this._events.on(e,t)}emit(e,...t){return(window.parent||window.opener).postMessage({eventName:e,args:t},this._origin),!0}}let c;t.Host=a,t.host=()=>{if(!c){const e=document.querySelector('meta[name="trusted-origin"]'),t=null==e?void 0:e.content;if(!t)throw new Error('could not find <meta name="trusted-origin" content="?" /> element');c=new a(t)}return c}},5237:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.proxy=t.Proxy=t.host=t.Host=void 0;const o=n(7520);Object.defineProperty(t,"host",{enumerable:!0,get:function(){return o.host}}),Object.defineProperty(t,"Host",{enumerable:!0,get:function(){return o.Host}});const i=n(5798);Object.defineProperty(t,"proxy",{enumerable:!0,get:function(){return i.proxy}}),Object.defineProperty(t,"Proxy",{enumerable:!0,get:function(){return i.Proxy}})},5798:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.proxy=t.Proxy=void 0;const o=n(1635),i=n(7007),r=n(6410),s=n(8251);class a{constructor(){this._events=new i.EventEmitter}open(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=new URL(e);return this._origin=t.origin,addEventListener(r.MessageEvent,(0,s.makeListener)(this._events,this._origin),{}),new Promise((t=>{const n=document.createElement(r.IframeElement);n.style.border=r.None,n.style.width=r.ZeroPixels,n.style.height=r.ZeroPixels,n.setAttribute(r.SandboxAttribute,r.SandboxRequirements),n.addEventListener(r.LoadEvent,(()=>{this._hostWindow=n.contentWindow,t()}),{}),n.setAttribute(r.SrcAttribute,e),document.body.appendChild(n)}))}))}on(e,t){this._events.on(e,t)}emit(e,...t){if(!this._origin||!this._hostWindow)throw new Error("host has not been opened");return this._hostWindow.postMessage({eventName:e,args:t},this._origin),!0}invoke(e,...t){return o.__awaiter(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{const i=Math.random().toString(16).slice(2);this._events.once(`rpcResult:${i}`,(e=>{e instanceof Error?o(e):n(e)})),this.emit(r.RpcCall,...[e,i].concat(...t))}))}))}}t.Proxy=a,t.proxy=new a},6410:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IframeElement=t.ZeroPixels=t.None=t.SandboxRequirements=t.SandboxAttribute=t.SrcAttribute=t.RpcCall=t.LoadEvent=t.MessageEvent=void 0,t.MessageEvent="message",t.LoadEvent="load",t.RpcCall="rpcCall",t.SrcAttribute="src",t.SandboxAttribute="sandbox",t.SandboxRequirements="allow-scripts allow-same-origin",t.None="none",t.ZeroPixels="0px",t.IframeElement="iframe"},8251:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeListener=void 0,t.makeListener=function(e,t){return n=>{if(n.origin!==t)return void console.warn(`dropping untrusted message from ${n.origin}`);const o=n.data;o.eventName&&o.args?e.emit(o.eventName,...o.args):console.warn(`dropping bad message from ${n.origin}`)}}},5250:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(5305),r=n(4999),s=o.__importDefault(n(6092)),a=o.__importDefault(n(192)),c=o.__importDefault(n(5834)),u=o.__importDefault(n(300)),d=o.__importDefault(n(7931)),l=o.__importDefault(n(3449)),f=n(5926),p=n(4835),h=n(7296);t.default=class{constructor(e){this._config=e,this._api=new r.KetchWebAPI((0,u.default)(this._config))}build(){var e,t,n,r;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,i.wrapLogger)(d.default,"build");if(o.info(this._config),!this._config||!this._config.organization)throw c.default.invalidConfigurationError;const a=l.default.get(s.default.EXPERIENCE_VERSION);if(a){let e="";if(this._config.scripts)for(let t=0;t<this._config.scripts.length;t+=1)this._config.scripts[t].includes("lanyard")&&(e=this._config.scripts[t]);let t=!1;if(e.includes("/v1/")&&"new"===a?(e=e.replace("/v1/","/v2/"),t=!0):e.includes("/v2/")&&"old"===a&&(e=e.replace("/v2/","/v1/"),t=!0),t){const t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.defer=!0,n.async=!0,n.src=e,t.appendChild(n)}}const p=this.formatLanguage(new URLSearchParams(window.location.search).get(s.default.LANGUAGE)||l.default.get(s.default.LANGUAGE)||document.documentElement.lang||document.documentElement.getAttribute("xml:lang")||window.navigator.language||this._config.language||"en");if((null===(e=this._config.property)||void 0===e?void 0:e.code)&&(null===(t=this._config.environment)||void 0===t?void 0:t.code)&&(null===(n=this._config.jurisdiction)||void 0===n?void 0:n.code)&&this._config.language===p){o.debug("full configuration");const e=new f.Ketch(this._api,this._config);return yield e.setEnvironment(this._config.environment),yield e.setJurisdiction(this._config.jurisdiction.code),e}const _=yield this.buildEnvironment();let g,v=l.default.get(s.default.REGION);v||(g=yield this.buildGeoIP(),v=yield this.buildRegionInfo(g));const E=yield this.buildJurisdiction(v),y={organizationCode:(0,h.santizePaths)(this._config.organization.code),propertyCode:(0,h.santizePaths)((null===(r=this._config.property)||void 0===r?void 0:r.code)||""),environmentCode:(0,h.santizePaths)(_.code),hash:(0,h.santizePaths)(_.hash||""),languageCode:(0,h.santizePaths)(p),jurisdictionCode:(0,h.santizePaths)(E)};o.info("loadConfig",y);const b=yield this._api.getFullConfiguration(y);a&&b.services&&(b.services[s.default.API_SERVER]=(0,u.default)(this._config));const m=new f.Ketch(this._api,b);return yield m.setEnvironment(_),g&&(yield m.setGeoIP(g)),yield m.setRegionInfo(v),yield m.setJurisdiction(E),yield this.setupTelemetry(m,b,{region:v}),m}))}setupTelemetry(e,t,n){var i,r,a,c,u,l,f,h;return o.__awaiter(this,void 0,void 0,(function*(){if(!t.services||!t.services.telemetry||""===t.services.telemetry)return!1;const o=parseFloat((null===(i=t.options)||void 0===i?void 0:i.beaconPercentage)||"1");let _=Math.random()<o;if(!_)return!1;const g={organizationCode:null!==(r=t.organization.code)&&void 0!==r?r:"",propertyCode:null!==(c=null===(a=t.property)||void 0===a?void 0:a.code)&&void 0!==c?c:"",environmentCode:null!==(l=null===(u=t.environment)||void 0===u?void 0:u.code)&&void 0!==l?l:"",jurisdictionCode:null!==(h=null===(f=t.jurisdiction)||void 0===f?void 0:f.code)&&void 0!==h?h:"",purposes:{},identities:{}},v=yield(0,p.getCachedConsent)(g,this._config),E=!!(v.collectedAt&&v.collectedAt>0);return e.once(s.default.IDENTITIES_EVENT,(e=>{var o;const i=this.collectTelemetry(E,t,n,e,"once_identities");try{navigator.sendBeacon(`${null===(o=t.services)||void 0===o?void 0:o.telemetry}?${i.toString()}`)}catch(e){d.default.debug("telemetry error",e)}})),document.addEventListener("visibilitychange",(()=>{var o;if("hidden"===document.visibilityState&&_){_=!1;const i=e.getCurrentIdentities(),r=this.collectTelemetry(E,t,n,i,"visibility_hidden");try{navigator.sendBeacon(`${null===(o=t.services)||void 0===o?void 0:o.telemetry}?${r.toString()}`)}catch(e){d.default.debug("telemetry error",e)}}})),!0}))}collectTelemetry(e,t,n,o,i){var r,s,a,c;const u=new URLSearchParams,d=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;u.append("hasConsent",`${e}`),u.append("url",d),u.append("property",(null===(r=t.property)||void 0===r?void 0:r.code)||""),u.append("environment",(null===(s=t.environment)||void 0===s?void 0:s.code)||""),u.append("jurisdiction",(null===(a=t.jurisdiction)||void 0===a?void 0:a.code)||""),u.append("tenant",t.organization.code),u.append("dver",`${null===(c=t.deployment)||void 0===c?void 0:c.version}`),u.append("event_type",i),u.append("ids",window.btoa(JSON.stringify(o)));for(const[e,t]of Object.entries(n))u.append(e,t);return u}buildEnvironment(){return o.__awaiter(this,void 0,void 0,(function*(){const e=(0,i.wrapLogger)(d.default,"buildEnvironment");if(this._config.environment)return e.trace(this._config.environment),this._config.environment;if(!this._config.environments||0===this._config.environments.length)throw e.trace("no environments"),c.default.noEnvironmentError;const t=l.default.get(s.default.ENV);if(t){for(let n=0;n<this._config.environments.length;n+=1){const o=this._config.environments[n];if(o&&t&&o.code===t)return e.debug("found",o),o}throw e.trace("unknown environment"),c.default.noEnvironmentError}let n={};for(let e=0;e<this._config.environments.length;e+=1){const t=this._config.environments[e],o=atob(t.pattern||"");o&&new RegExp(o).test(window.document.location.href)&&(!n.pattern||o.length>atob(n.pattern).length)&&(n=t)}if(n.pattern)return e.debug("matched",n),n;for(let t=0;t<this._config.environments.length;t+=1){const n=this._config.environments[t];if(n.code===s.default.PRODUCTION)return e.debug(n.code,n),n}throw c.default.noEnvironmentError}))}formatLanguage(e){var t;const n=e.split("-")[0],o=null===(t=e.split("-")[1])||void 0===t?void 0:t.toUpperCase();return`${n}${o?`-${o}`:""}`}buildJurisdiction(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=(0,i.wrapLogger)(d.default,"buildJurisdiction");t.debug(this._config.jurisdiction);const n=l.default.get(s.default.JURISDICTION);if(n)return t.trace("override",n),n;const o=this._config.jurisdiction;if(!o)throw t.trace("no jurisdiction config"),c.default.noJurisdictionError;if(o.code)return t.trace(o.code),o.code;const r=document.documentElement.getAttribute("jurisdiction");if(r)return t.trace("document jurisdiction",r),r;const u=o.variable;if(u)for(const e of(0,a.default)()){const n=e[u];if(n)return t.trace("dataLayer jurisdiction",n),n}if(o.jurisdictions){const n=o.jurisdictions[e];if(n)return t.trace("region jurisdiction",n),n}if(o.defaultJurisdictionCode)return t.trace("default jurisdiction",o.defaultJurisdictionCode),o.defaultJurisdictionCode;throw c.default.noJurisdictionError}))}buildRegionInfo(e){var t;return o.__awaiter(this,void 0,void 0,(function*(){const n=(0,i.wrapLogger)(d.default,"buildRegionInfo");if(("US"===e.countryCode||"CA"===e.countryCode)&&e.regionCode){const t=`${e.countryCode}-${e.regionCode}`;return n.trace(t),t}const o=null!==(t=e.countryCode)&&void 0!==t?t:"US";return n.trace(o),o}))}buildGeoIP(){return o.__awaiter(this,void 0,void 0,(function*(){d.default.debug("buildGeoIP");const e=yield this._api.getLocation();if(!e||!e.location)throw c.default.unrecognizedLocationError;return e.location}))}}},436:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addToKetchLog=void 0,t.addToKetchLog=(e,t)=>{window.KetchLog||(window.KetchLog={}),window.KetchLog[e]||(window.KetchLog[e]=t)}},2433:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=o.__importDefault(n(7931)),r=n(5305),s=n(436),a=o.__importDefault(n(6092));t.default=class{constructor(e,t){this._blockedCookies=new Set,this.getGrantedPurposes=()=>o.__awaiter(this,void 0,void 0,(function*(){const e=(0,r.wrapLogger)(i.default,"CookieBlocker: getGrantedPurposes"),t=yield this._ketch.getConsent(),n=(null==t?void 0:t.purposes)||{};return e.debug("got consent purposes",n),new Set(Object.keys(n).filter((e=>!0===n[e])))})),this.execute=()=>o.__awaiter(this,void 0,void 0,(function*(){const e=(0,r.wrapLogger)(i.default,"CookieBlocker: execute"),t=document.cookie.split(";");if(!t.length)return e.debug("no browser cookies"),Array.from(this._blockedCookies);const n=window.location.hostname,o=yield this.getGrantedPurposes();return e.debug("granted purposes",o),Object.entries(this._config.blockedCookies||{}).forEach((([i,{purposeCodes:r,regex:s}])=>{if(r.some((e=>o.has(e))))return void e.debug(`not blocking ${i} as consent is granted for one of its purposes`);const a=new RegExp(s||"");t.forEach((t=>{const[o,r]=t.trim().split("=");!this._blockedCookies.has(o)&&(s&&a.test(o)||!s&&o===i)&&(document.cookie=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.${n};`,this._blockedCookies.add(o),e.debug(`Deleted cookie: ${o} for domain: .${n}`))}))})),(0,s.addToKetchLog)("getBlockedCookies",(()=>{console.group(`Blocked Cookies (${this._blockedCookies.size}) ðŸª`),this._blockedCookies.size||console.log("No blocked cookies"),this._blockedCookies.forEach((e=>console.log(e))),console.groupEnd()})),Array.from(this._blockedCookies)})),this._ketch=e,this._config=t,this._ketch.on(a.default.CONSENT_EVENT,(()=>this.execute())),window.addEventListener("DOMContentLoaded",(()=>this.execute()))}}},8297:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635).__importDefault(n(3004));class i extends o.default{constructor(e){super(e)}experienceClosed(e,t){return this._ketch.experienceClosed(e,t).then((()=>{}))}invokeRight(e){return this._ketch.invokeRight(e)}setProvisionalConsent(e){return this._ketch.setProvisionalConsent(e)}getSubscriptions(){return this._ketch.getSubscriptions()}setSubscriptions(e){return this._ketch.setSubscriptions(e)}getSubscriptionConfiguration(){return this._ketch.getSubscriptionConfiguration()}getConsentConfiguration(){return this._ketch.getConsentConfiguration()}getPreferenceConfiguration(){return this._ketch.getPreferenceConfiguration()}getIsExperienceDisplayed(){return this._ketch.getIsExperienceDisplayed()}willChangeExperience(e){return this._ketch.willChangeExperience(e).then((()=>{}))}hasChangedExperience(e){return this._ketch.hasChangedExperience(e).then((()=>{}))}hasShownExperience(){return this._ketch.hasShownExperience().then((()=>{}))}}t.default=i},5926:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ketch=void 0;const o=n(1635),i=n(7007),r=o.__importDefault(n(8138)),s=n(8509),a=o.__importDefault(n(9220)),c=o.__importDefault(n(9207)),u=n(5305),d=n(5237),l=o.__importDefault(n(7262)),f=o.__importDefault(n(3044)),p=o.__importDefault(n(7931)),h=o.__importDefault(n(5834)),_=o.__importDefault(n(3449)),g=n(4835),v=o.__importStar(n(6092)),E=o.__importDefault(n(8297));class y extends i.EventEmitter{constructor(e,t){var n,o,i,s,c,u;super();const d=parseInt(null!==(o=null===(n=t.options)||void 0===n?void 0:n.maxListeners)&&void 0!==o?o:"20");this._api=e,this._config=t,this._consent=new r.default({name:v.default.CONSENT_EVENT,emitter:this,maxListeners:d}),this._protocols=new r.default({name:v.default.PROTOCOLS_EVENT,emitter:this,maxListeners:d}),this._environment=new r.default({name:v.default.ENVIRONMENT_EVENT,emitter:this,maxListeners:d}),this._geoip=new r.default({name:v.default.GEOIP_EVENT,emitter:this,maxListeners:d}),this._handleKeyboardEvent=new r.default({name:v.default.HANDLE_KEYBOARD_EVENT,emitter:this,maxListeners:d}),this._identities=new r.default({name:v.default.IDENTITIES_EVENT,emitter:this,maxListeners:d}),this._identitiesCurrent={},this._jurisdiction=new r.default({name:v.default.JURISDICTION_EVENT,emitter:this,maxListeners:d}),this._regionInfo=new r.default({name:v.default.REGION_INFO_EVENT,emitter:this,maxListeners:d}),this._returnKeyboardControl=new r.default({name:v.default.RETURN_KEYBOARD_CONTROL,emitter:this,maxListeners:d}),this._subscriptionConfig=new r.default({name:v.default.SUBSCRIPTIONS_EVENT,emitter:this,maxListeners:d}),this._subscriptions=new r.default({name:v.default.SUBSCRIPTION_CONFIG_EVENT,emitter:this,maxListeners:d}),this._consentConfig=new r.default,this._preferenceConfig=new r.default,this._isExperienceDisplayed=!1,this._hasExperienceBeenDisplayed=!1,this._hasProxyLoaded=!1,this._provisionalConsent=void 0,this._watcher=new a.default(window,{interval:parseInt(null!==(s=null===(i=t.options)||void 0===i?void 0:i.watcherInterval)&&void 0!==s?s:"2000"),timeout:parseInt(null!==(u=null===(c=t.options)||void 0===c?void 0:c.watcherTimeout)&&void 0!==u?u:"10000")}),this._watcher.on(v.default.IDENTITY_EVENT,this.setIdentities.bind(this)),this.setMaxListeners(d)}registerPlugin(e,t){return o.__awaiter(this,void 0,void 0,(function*(){const n=new E.default(this),o=t||(yield this.getConfig());return e instanceof Function?e(n,o):(void 0!==e.willShowExperience&&this.on(v.default.WILL_SHOW_EXPERIENCE_EVENT,(t=>{void 0!==e.willShowExperience&&e.willShowExperience(n,this._config,t)})),void 0!==e.showConsentExperience&&this.on(v.default.SHOW_CONSENT_EXPERIENCE_EVENT,((t,o)=>{void 0!==e.showConsentExperience&&e.showConsentExperience(n,this._config,t,o)})),void 0!==e.showPreferenceExperience&&this.on(v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT,((t,o)=>{void 0!==e.showPreferenceExperience&&e.showPreferenceExperience(n,this._config,t,o)})),void 0!==e.consentChanged&&this.on(v.default.CONSENT_EVENT,(t=>{void 0!==e.consentChanged&&e.consentChanged(n,this._config,t)})),void 0!==e.environmentLoaded&&this.on(v.default.ENVIRONMENT_EVENT,(t=>{void 0!==e.environmentLoaded&&e.environmentLoaded(n,this._config,t)})),void 0!==e.experienceHidden&&this.on(v.default.HIDE_EXPERIENCE_EVENT,(t=>{void 0!==e.experienceHidden&&e.experienceHidden(n,this._config,t)})),void 0!==e.geoIPLoaded&&this.on(v.default.GEOIP_EVENT,(t=>{void 0!==e.geoIPLoaded&&e.geoIPLoaded(n,this._config,t)})),void 0!==e.identitiesLoaded&&this.on(v.default.IDENTITIES_EVENT,(t=>{void 0!==e.identitiesLoaded&&e.identitiesLoaded(n,this._config,t)})),void 0!==e.jurisdictionLoaded&&this.on(v.default.JURISDICTION_EVENT,(t=>{void 0!==e.jurisdictionLoaded&&e.jurisdictionLoaded(n,this._config,t)})),void 0!==e.regionInfoLoaded&&this.on(v.default.REGION_INFO_EVENT,(t=>{void 0!==e.regionInfoLoaded&&e.regionInfoLoaded(n,this._config,t)})),void 0!==e.rightInvoked&&this.on(v.default.RIGHT_INVOKED_EVENT,(t=>{void 0!==e.rightInvoked&&e.rightInvoked(n,this._config,t)})),void 0!==e.init?e.init(n,o):Promise.resolve())}))}registerIdentityProvider(e,t){return o.__awaiter(this,void 0,void 0,(function*(){this._watcher.add(e,t)}))}registerStorageProvider(e,t){return o.__awaiter(this,void 0,void 0,(function*(){}))}registerExperienceServer(e){return o.__awaiter(this,void 0,void 0,(function*(){}))}getConfig(){return o.__awaiter(this,void 0,void 0,(function*(){return this._config}))}getFullConfig(){var e,t,n,i,r,s,a,c,u,d,l,f,p,h,_,g,v,E,y;return o.__awaiter(this,void 0,void 0,(function*(){const o=yield this.getConsentConfiguration(),b=yield this.getPreferenceConfiguration(),m=this._config;return Object.assign(Object.assign({},m),{theme:{banner:null===(e=o.theme)||void 0===e?void 0:e.banner,modal:null===(t=o.theme)||void 0===t?void 0:t.modal,preference:null===(n=b.theme)||void 0===n?void 0:n.preference},experiences:{content:{banner:null===(r=null===(i=o.experiences)||void 0===i?void 0:i.content)||void 0===r?void 0:r.banner,modal:null===(a=null===(s=o.experiences)||void 0===s?void 0:s.content)||void 0===a?void 0:a.modal,display:null===(u=null===(c=o.experiences)||void 0===c?void 0:c.content)||void 0===u?void 0:u.display,preference:null===(l=null===(d=b.experiences)||void 0===d?void 0:d.content)||void 0===l?void 0:l.preference,static:null===(p=null===(f=o.experiences)||void 0===f?void 0:f.content)||void 0===p?void 0:p.static},layout:{banner:null===(_=null===(h=o.experiences)||void 0===h?void 0:h.layout)||void 0===_?void 0:_.banner,modal:null===(v=null===(g=o.experiences)||void 0===g?void 0:g.layout)||void 0===v?void 0:v.modal,preference:null===(y=null===(E=b.experiences)||void 0===E?void 0:E.layout)||void 0===y?void 0:y.preference}}})}))}selectExperience(e){const t=(0,u.wrapLogger)(p.default,"selectExperience");if(this._hasExperienceBeenDisplayed)t.debug(v.default.NONE);else{if(_.default.get(v.default.SHOW)===v.default.PREFERENCES)return t.debug(s.ExperienceType.Preference),s.ExperienceType.Preference;if(_.default.has(v.default.SHOW))return t.debug(s.ExperienceType.Consent),s.ExperienceType.Consent;if(this._config.purposes)for(const n of this._config.purposes)if(void 0===e.purposes[n.code])return t.debug(s.ExperienceType.Consent),s.ExperienceType.Consent;t.debug(v.default.NONE)}}selectConsentExperience(){var e,t,n;const o=(0,u.wrapLogger)(p.default,"selectConsentExperience");if(this._config.purposes&&this._config.purposes.length&&(null===(e=this._config.experiences)||void 0===e?void 0:e.consent)&&(null===(n=null===(t=this._config.experiences)||void 0===t?void 0:t.consent)||void 0===n?void 0:n.experienceDefault)===s.ExperienceDefault.MODAL)for(const e of this._config.purposes)if(e.requiresOptIn)return o.debug(s.ConsentExperienceType.Modal),s.ConsentExperienceType.Modal;return o.debug(s.ConsentExperienceType.Banner),s.ConsentExperienceType.Banner}willShowExperience(e){var t;p.default.debug("willShowExperience",e),this.emit(v.default.WILL_SHOW_EXPERIENCE_EVENT,e);const n=null===(t=this._config.experiences)||void 0===t?void 0:t.layout;n&&(e!==s.ExperienceType.Consent||n.banner||n.modal)&&(e!==s.ExperienceType.Preference||n.preference)&&(this._isExperienceDisplayed=!0)}experienceClosed(e,t){return o.__awaiter(this,void 0,void 0,(function*(){if(p.default.debug("experienceClosed",e),this._isExperienceDisplayed=!1,this._hasExperienceBeenDisplayed=!0,e!==s.ExperienceClosedReason.CLOSE_WITHOUT_SETTING_CONSENT)if(t&&e===s.ExperienceClosedReason.SET_CONSENT)yield this.setConsent(t,s.SetConsentReason.USER_UPDATE);else if(e!==s.ExperienceClosedReason.SET_CONSENT){const e=yield this.retrieveConsent();if(this._config.purposes)for(const t of this._config.purposes)void 0===e.purposes[t.code]&&t.requiresOptIn&&(e.purposes[t.code]=!1);yield this.setConsent(e,s.SetConsentReason.USER_EXPERIENCE_DISMISSAL)}return setTimeout((()=>{this.emit(v.default.HIDE_EXPERIENCE_EVENT,e)}),0),this.retrieveConsent()}))}willChangeExperience(e){return o.__awaiter(this,void 0,void 0,(function*(){p.default.debug("willChangeExperience",e),this.emit(v.default.WILL_CHANGE_EXPERIENCE_EVENT,e)}))}hasChangedExperience(e){return o.__awaiter(this,void 0,void 0,(function*(){p.default.debug("hasChangedExperience",e),this.emit(v.default.HAS_CHANGED_EXPERIENCE_EVENT,e)}))}hasShownExperience(){return o.__awaiter(this,void 0,void 0,(function*(){p.default.debug("hasShownExperience"),this.emit(v.default.HAS_SHOWN_EXPERIENCE_EVENT)}))}showExperience(e){return o.__awaiter(this,void 0,void 0,(function*(){}))}showConsentExperience(e){var t,n;return o.__awaiter(this,void 0,void 0,(function*(){if((null===(t=this._config.deployment)||void 0===t?void 0:t.isOrchestrationOnly)||(null===(n=this._config)||void 0===n?void 0:n.isConfigPaused))return{};(0,u.wrapLogger)(p.default,"showConsentExperience").debug(e);const o=yield this.retrieveConsent();return this.listenerCount(v.default.SHOW_CONSENT_EXPERIENCE_EVENT)>0?this.showConsentExperienceTrigger(o):this.on("addedListener",(t=>{t===v.default.SHOW_CONSENT_EXPERIENCE_EVENT&&this.showConsentExperienceTrigger(o,e)})),o}))}showConsentExperienceTrigger(e,t){p.default.debug("showConsentExperienceTrigger");const n=Object.assign({displayHint:this.selectConsentExperience()},t);this.willShowExperience(s.ExperienceType.Consent),this.emit(v.default.SHOW_CONSENT_EXPERIENCE_EVENT,e,n)}showPreferenceExperience(e){var t,n,i,r;return o.__awaiter(this,void 0,void 0,(function*(){if((null===(t=this._config.deployment)||void 0===t?void 0:t.isOrchestrationOnly)||(null===(n=this._config)||void 0===n?void 0:n.isConfigPaused))return{};const o=(0,u.wrapLogger)(p.default,"showPreferenceExperience");let a;o.debug(e);let c=!0;try{a=yield this.getConsent()}catch(e){if(e!==h.default.noPurposesError)throw e;o.debug("No purposes detected, experience will not display consents tab"),a=v.EMPTY_CONSENT,c=!1}e=null!=e?e:{};const d=_.default.get(v.default.PREFERENCES_TAB);d&&(0,s.isTab)(d)&&(e.tab=d,o.info("tab",d));const l=null===(r=null===(i=_.default.get(v.default.PREFERENCES_TABS))||void 0===i?void 0:i.split(","))||void 0===r?void 0:r.filter((e=>e&&(0,s.isTab)(e)));(null==l?void 0:l.length)&&(e.showOverviewTab=l.includes(s.Tab.Overview),e.showConsentsTab=c&&l.includes(s.Tab.Consents),e.showSubscriptionsTab=l.includes(s.Tab.Subscriptions),e.showRightsTab=l.includes(s.Tab.Rights),e.tab=l.includes(e.tab||"")?e.tab:l[0]);try{const t=yield this.getSubscriptionConfiguration();if(void 0!==t){if(void 0===e.showSubscriptionsTab&&(e.showSubscriptionsTab=!0),void 0!==t.topics&&0!==t.topics.length&&0!==Object.keys(t.identities).length||(e.showSubscriptionsTab=!1,o.trace("not showing subscriptions because invalid subscription config")),e.showSubscriptionsTab){let n=!1;const i=yield this.getIdentities();for(const e of Object.keys(t.identities))if(i[e]){n=!0;break}n||(o.trace("not showing subscriptions because no auth identities"),e.showSubscriptionsTab=!1)}}else o.trace("invalid subscription config"),e.showSubscriptionsTab=!1}catch(t){o.trace("invalid subscription config"),e.showSubscriptionsTab=!1}return e.showSubscriptionsTab||e.tab!==s.Tab.Subscriptions||(e.tab=void 0),this.listenerCount(v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT)>0?this.showPreferenceExperienceTrigger(e,a):this.on("addedListener",(t=>{t===v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT&&this.showPreferenceExperienceTrigger(e,a)})),a}))}showPreferenceExperienceTrigger(e,t){(0,u.wrapLogger)(p.default,"showPreferenceExperienceTrigger").debug(e),this.willShowExperience(s.ExperienceType.Preference),this.emit(v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT,t,e)}showProgressiveExperience(e){return p.default.debug("showProgressiveExperience",e),this.emit(v.default.SHOW_PROGRESSIVE_EXPERIENCE_EVENT,e),Promise.resolve()}onShowConsentExperience(e){return o.__awaiter(this,void 0,void 0,(function*(){p.default.debug("onShowConsentExperience"),this.removeAllListeners(v.default.SHOW_CONSENT_EXPERIENCE_EVENT),this.on(v.default.SHOW_CONSENT_EXPERIENCE_EVENT,e)}))}onShowPreferenceExperience(e){return o.__awaiter(this,void 0,void 0,(function*(){p.default.debug("onShowPreferenceExperience"),this.removeAllListeners(v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT),this.on(v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT,e)}))}hasConsent(){return this._consent.isFulfilled()}setConsent(e,t){return o.__awaiter(this,void 0,void 0,(function*(){const n=(0,u.wrapLogger)(p.default,"setConsent");if(n.debug(e),!e||(0,f.default)(e))return n.trace("reset"),this._consent.reset(),{};let o=!1;if(this.hasConsent()){n.trace("has consent");const t=this._consent.value;o=(0,c.default)(t.purposes,e.purposes);for(const n in t.purposes)Object.prototype.hasOwnProperty.call(t.purposes,n)&&!Object.prototype.hasOwnProperty.call(e.purposes,n)&&(e.purposes[n]=t.purposes[n]);e.protocols=t.protocols}this._consent.value=e;const i=yield this.getIdentities();try{const n=yield this.updateConsent(i,e);n&&void 0!==n.protocols&&(this._protocols.value=n.protocols),t===s.SetConsentReason.USER_UPDATE&&(this._watcher.stop(),yield this._watcher.start(),o||this.emit(v.default.USER_CONSENT_UPDATED_EVENT,e))}catch(e){let t="";e instanceof Error&&(t=e.message),n.warn("unable to update consent",t)}return e}))}setProvisionalConsent(e){return o.__awaiter(this,void 0,void 0,(function*(){p.default.debug("setProvisionalConsent",e),this._provisionalConsent=e}))}overrideWithProvisionalConsent(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=(0,u.wrapLogger)(p.default,"overrideWithProvisionalConsent");t.debug(e);let n=!1;if(!this._provisionalConsent)return t.trace("no provisional consent"),[e,n];for(const t in this._provisionalConsent.purposes)e.purposes[t]!==this._provisionalConsent.purposes[t]&&(e.purposes[t]=this._provisionalConsent.purposes[t],n=!0);return this._provisionalConsent=void 0,t.trace("merged",e),[e,n]}))}resetConsent(){return o.__awaiter(this,void 0,void 0,(function*(){return this._watcher.stop(),yield this._watcher.start(),this._consent.reset(),this._config.options=Object.assign(Object.assign({},this._config.options),{"Cache-Control":"no-cache"}),this.getConsent()}))}getConsent(){var e,t;return o.__awaiter(this,void 0,void 0,(function*(){const n=(0,u.wrapLogger)(p.default,"getConsent");if(this.hasConsent())return n.trace("has consent"),this._consent.fulfilled;n.debug("obtaining consent");const o=yield this.getIdentities(),i=yield this.fetchConsent(o),[r,a]=yield this.overrideWithProvisionalConsent(i);let c=a;const d=this.selectExperience(r);if(this._config.purposes)for(const e of this._config.purposes)void 0!==r.purposes[e.code]||e.requiresOptIn||(r.purposes[e.code]=!0,c=!0);if((null===(e=this._config.deployment)||void 0===e?void 0:e.isOrchestrationOnly)||(null===(t=this._config)||void 0===t?void 0:t.isConfigPaused))return{};switch(n.debug("shouldCreatePermits",c),c?yield this.setConsent(r,s.SetConsentReason.DEFAULT_STATE):(this._consent.value=r,void 0!==i.protocols&&(this._protocols.value=i.protocols)),d){case s.ExperienceType.Consent:return this.showConsentExperience();case s.ExperienceType.Preference:return this.showPreferenceExperience()}return this.emit(v.default.HIDE_EXPERIENCE_EVENT,s.ExperienceClosedReason.WILL_NOT_SHOW),this._consent.value}))}retrieveConsent(){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("retrieveConsent"),this._consent.isFulfilled()?this._consent.fulfilled:{purposes:{},vendors:[],googleVendors:[]}}))}fetchConsent(e){var t,n,i;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"fetchConsent");if(o.debug("identities",e),!e||0===Object.keys(e).length)throw h.default.noIdentitiesError;if(!(this._config&&this._config.property&&this._config.organization&&this._config.environment&&this._config.purposes&&this._config.jurisdiction&&0!==this._config.purposes.length))throw h.default.noPurposesError;const r={organizationCode:null!==(t=this._config.organization.code)&&void 0!==t?t:"",propertyCode:null!==(n=this._config.property.code)&&void 0!==n?n:"",environmentCode:this._config.environment.code,jurisdictionCode:null!==(i=this._config.jurisdiction.code)&&void 0!==i?i:"",identities:e,purposes:{}};for(const e of this._config.purposes)r.purposes[e.code]={legalBasisCode:e.legalBasisCode};o.debug("request",r);let s=yield(0,g.getCachedConsent)(r,this._config);const a=Math.floor(Date.now()/1e3-g.CACHED_CONSENT_TTL);let d=!1,l=!1;if(0===Object.keys(s.purposes).length?o.debug("cached consent is empty",s):(null==s?void 0:s.collectedAt)&&s.collectedAt<a?o.debug("revalidating cached consent",s):(0,c.default)(e,s.identities)?(o.debug("using cached consent",s),d=!0):(l=!0,o.debug("cached consent discarded due to identity mismatch",e,s.identities)),!d){if(this._config.purposes&&s.purposes&&!l)for(const e of this._config.purposes){const t=s.purposes[e.code];t&&(r.purposes[e.code]||(r.purposes[e.code]={}),r.purposes[e.code].allowed="string"==typeof t?t:t.allowed)}o.debug("calling getConsent",r),s=(e=>{var t;if(o.trace("normalizeConsent",e),!e.purposes)return e.purposes={},e;for(const n of Object.keys(e.purposes)){const o=e.purposes[n];"string"==typeof o&&(e.purposes[n]={allowed:o,legalBasisCode:null===(t=r.purposes[n])||void 0===t?void 0:t.legalBasisCode})}return o.trace("normalized",e),e})(yield this._api.getConsent(r)),o.debug("getConsent returned",s),yield(0,g.setCachedConsent)(s,this._config)}yield(0,g.setPublicConsent)(s,this._config);const f={purposes:{}};if(this._config.purposes&&s.purposes)for(const e of this._config.purposes)if(s.purposes[e.code]){const t=s.purposes[e.code];"string"==typeof t?f.purposes[e.code]="true"===t:t.allowed&&(f.purposes[e.code]="true"===t.allowed)}return s.vendors&&(f.vendors=s.vendors),s.googleVendors&&(f.googleVendors=s.googleVendors),s.protocols&&(f.protocols=s.protocols),o.debug("returning",f),f}))}updateConsent(e,t){var n,i,r;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"updateConsent");if(o.debug(e,t),!e||0===Object.keys(e).length)throw o.debug("no identities"),h.default.noIdentitiesError;if(!(this._config&&this._config.organization&&this._config.property&&this._config.environment&&this._config.jurisdiction&&this._config.purposes&&0!==this._config.purposes.length))throw o.debug("invalid configuration"),h.default.invalidConfigurationError;if((0,f.default)(t)||(0,f.default)(t.purposes))throw o.debug("empty consent"),h.default.emptyConsentError;const s={organizationCode:null!==(n=this._config.organization.code)&&void 0!==n?n:"",propertyCode:null!==(i=this._config.property.code)&&void 0!==i?i:"",environmentCode:this._config.environment.code,identities:e,jurisdictionCode:null!==(r=this._config.jurisdiction.code)&&void 0!==r?r:"",purposes:{},vendors:t.vendors,googleVendors:t.googleVendors,collectedAt:Math.floor(Date.now()/1e3)};if(this._config.purposes&&t)for(const e of this._config.purposes)void 0!==t.purposes[e.code]&&(s.purposes[e.code]={allowed:t.purposes[e.code].toString(),legalBasisCode:e.legalBasisCode});if((0,f.default)(s.purposes))return o.debug("calculated consents empty"),s;yield(0,g.setCachedConsent)(s,this._config),yield(0,g.setPublicConsent)(s,this._config);const a=yield this._api.setConsent(s);return yield(0,g.setCachedConsent)(a,this._config),a}))}getSubscriptions(){var e,t,n,i,r,s,a,c;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"getSubscriptions");if(void 0===this._config.organization||void 0===this._config.property||void 0===this._config.environment)return o.trace("exiting because invalid config",this._config),this._subscriptions.value={},{};if(this._subscriptions.isFulfilled())return o.trace("cached",this._subscriptions.value),this._subscriptions;const d=yield this.getSubscriptionConfiguration();if(0===d.topics.length||void 0===d.identities||0===Object.keys(d.identities).length)return o.trace("exiting because invalid subscription config",d,d.topics.length,d.identities,Object.keys(d.identities)),this._subscriptions.value={},{};const l={organizationCode:null!==(n=null===(t=null===(e=this._config)||void 0===e?void 0:e.organization)||void 0===t?void 0:t.code)&&void 0!==n?n:"",controllerCode:"",propertyCode:null!==(s=null===(r=null===(i=this._config)||void 0===i?void 0:i.property)||void 0===r?void 0:r.code)&&void 0!==s?s:"",environmentCode:null===(c=null===(a=this._config)||void 0===a?void 0:a.environment)||void 0===c?void 0:c.code,collectedAt:Math.floor(Date.now()/1e3),identities:{}},f=yield this.getIdentities();for(const e of Object.keys(d.identities))f[e]&&(l.identities[e]=f[e]);if(0===Object.keys(l.identities).length)return o.trace("exiting because no identities"),this._subscriptions.value={},{};const h=yield this._api.getSubscriptions(l);return this._subscriptions.value=h,o.trace("loaded",h),h}))}setSubscriptions(e){var t,n,i,r,s,a,c,d;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"setSubscriptions");if(o.trace("subscriptions",e,this._config),void 0===this._config.organization||void 0===this._config.property||void 0===this._config.environment)return void o.trace("exiting because of invalid config");const l=yield this.getSubscriptionConfiguration();if(0===l.topics.length||void 0===l.identities||0===Object.keys(l.identities).length)return void o.trace("exiting because of invalid subscription config",l,0===l.topics.length,l.identities,Object.keys(l.identities));const f={organizationCode:null!==(i=null===(n=null===(t=this._config)||void 0===t?void 0:t.organization)||void 0===n?void 0:n.code)&&void 0!==i?i:"",controllerCode:"",propertyCode:null!==(a=null===(s=null===(r=this._config)||void 0===r?void 0:r.property)||void 0===s?void 0:s.code)&&void 0!==a?a:"",environmentCode:null===(d=null===(c=this._config)||void 0===c?void 0:c.environment)||void 0===d?void 0:d.code,topics:e.topics,controls:e.controls,collectedAt:Math.floor(Date.now()/1e3),identities:{}},h=yield this.getIdentities();for(const e of Object.keys(l.identities))h[e]&&(f.identities[e]=h[e]);return 0===Object.keys(f.identities).length?(o.trace("exiting because no identities"),void(this._subscriptions.value={})):(this._subscriptions.value=e,this._api.setSubscriptions(f))}))}getSubscriptionConfiguration(){var e,t,n,i,r,s,a,c,d,l,f,h,_,g,v,E,y,b,m,C,w,T,N,O,I,S;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"getSubscriptionConfiguration");if(o.trace("config",this._config),this._subscriptionConfig.isFulfilled())return o.trace("cached",this._subscriptionConfig.value),this._subscriptionConfig;if(!(null===(n=null===(t=null===(e=this._config)||void 0===e?void 0:e.experiences)||void 0===t?void 0:t.preference)||void 0===n?void 0:n.code)||(null===(s=null===(r=null===(i=this._config)||void 0===i?void 0:i.services)||void 0===r?void 0:r.shoreline)||void 0===s?void 0:s.includes("v3"))){const e=yield this.getPreferenceConfiguration();return e.subscription?e.subscription:(this._subscriptionConfig.value={contactMethods:{},controls:[],identities:{},language:null!==(c=null===(a=this._config)||void 0===a?void 0:a.language)&&void 0!==c?c:"",organization:{code:null!==(f=null===(l=null===(d=this._config)||void 0===d?void 0:d.organization)||void 0===l?void 0:l.code)&&void 0!==f?f:""},property:{code:null!==(g=null===(_=null===(h=this._config)||void 0===h?void 0:h.property)||void 0===_?void 0:_.code)&&void 0!==g?g:""},topics:[]},this._subscriptionConfig.value)}const P=yield this._api.getSubscriptionsConfiguration({organizationCode:null!==(y=null===(E=null===(v=this._config)||void 0===v?void 0:v.organization)||void 0===E?void 0:E.code)&&void 0!==y?y:"",propertyCode:null!==(C=null===(m=null===(b=this._config)||void 0===b?void 0:b.property)||void 0===m?void 0:m.code)&&void 0!==C?C:"",languageCode:null!==(T=null===(w=this._config)||void 0===w?void 0:w.language)&&void 0!==T?T:"",experienceCode:null!==(S=null===(I=null===(O=null===(N=this._config)||void 0===N?void 0:N.experiences)||void 0===O?void 0:O.preference)||void 0===I?void 0:I.code)&&void 0!==S?S:""});return o.trace("loaded",P),this._subscriptionConfig.value=P,P}))}getConsentConfiguration(){var e,t,n,i,r,s,a,c;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"getConsentConfiguration");if(o.trace("config",this._config),this._consentConfig.isFulfilled())return o.trace("cached",this._consentConfig.value),this._consentConfig;const d=yield this._api.getConsentConfiguration({organizationCode:this._config.organization.code,propertyCode:null!==(t=null===(e=this._config.property)||void 0===e?void 0:e.code)&&void 0!==t?t:"",envCode:null!==(i=null===(n=this._config.environment)||void 0===n?void 0:n.code)&&void 0!==i?i:"",jurisdictionCode:null!==(s=null===(r=this._config.jurisdiction)||void 0===r?void 0:r.code)&&void 0!==s?s:"",langCode:null!==(a=this._config.language)&&void 0!==a?a:"",hash:null===(c=this._config.environment)||void 0===c?void 0:c.hash});return o.trace("loaded",d),this._consentConfig.value=d,d}))}getPreferenceConfiguration(){var e,t,n,i,r,s,a,c;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"getPreferenceConfiguration");if(o.trace("config",this._config),this._preferenceConfig.isFulfilled())return o.trace("cached",this._preferenceConfig.value),this._preferenceConfig;const d=yield this._api.getPreferenceConfiguration({organizationCode:this._config.organization.code,propertyCode:null!==(t=null===(e=this._config.property)||void 0===e?void 0:e.code)&&void 0!==t?t:"",envCode:null!==(i=null===(n=this._config.environment)||void 0===n?void 0:n.code)&&void 0!==i?i:"",jurisdictionCode:null!==(s=null===(r=this._config.jurisdiction)||void 0===r?void 0:r.code)&&void 0!==s?s:"",langCode:null!==(a=this._config.language)&&void 0!==a?a:"",hash:null===(c=this._config.environment)||void 0===c?void 0:c.hash});return o.trace("loaded",d),this._preferenceConfig.value=d,d}))}setEnvironment(e){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("setEnvironment",e),this._environment.value=e,this._environment.fulfilled}))}getEnvironment(){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("getEnvironment"),this._environment.fulfilled}))}setGeoIP(e){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("setGeoIP",e),this._geoip.value=e,this._geoip.fulfilled}))}getGeoIP(){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("getGeoIP"),this._geoip.fulfilled}))}extractGAID(e){const t=/^GA\d\.\d\.(\d+\.\d+)$/.exec(e);return t?"GA1.1."+t[1]:e}setIdentities(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=(0,u.wrapLogger)(p.default,"setIdentities");t.debug(e);let n={};this._identities.isFulfilled()&&(n=this._identities.value);for(const o in e)"google_analytics_cookie"!==o||"utc"!==this._config.organization.code&&"vara_labs"!==this._config.organization.code||(t.debug("altering google_analytics_cookie to get id with GA1.1. prefix"),e[o]=this.extractGAID(e[o])),n[o]=e[o];if(this._identities.value=n,this._identitiesCurrent=n,this._isExperienceDisplayed)return t.trace("experience displayed"),n;const o=yield this.retrieveConsent();if(0==Object.keys(o.purposes).length)return n;const i=yield this.fetchConsent(n);if((0,c.default)(i.purposes,o.purposes)){let e=!1;for(const t in i)if(i.purposes[t]!==o.purposes[t]){e=!0;break}if(!e)return n}if(this._hasExperienceBeenDisplayed){t.trace("updating consent because experience displayed");try{yield this.updateConsent(n,o)}catch(e){let n="";e instanceof Error&&(n=e.message),t.warn("unable to update consent",n)}return n}return yield this.showConsentExperience(),n}))}collectIdentities(){var e,t,n;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"collectIdentities");o.debug(this._config.identities);const i=this._config.identities;if(!this._config||!this._config.organization||void 0===i||(0,f.default)(i))return o.trace("invalid configuration"),void(this._identities.value={});const r=this._watcher;let a=(e,t)=>{r.add(e,t)};if(null===(e=this._config.property)||void 0===e?void 0:e.proxy)try{const e=new URL(null===(t=this._config.property)||void 0===t?void 0:t.proxy),n=new URL(window.location.href);if(e.origin!==n.origin&&(a=(e,t)=>{i[e].type!==s.IdentityType.IDENTITY_TYPE_LOCAL_STORAGE&&r.add(e,t)},!this._hasProxyLoaded)){this._hasProxyLoaded=!0,yield d.proxy.open(e.toString());for(const e of Object.keys(i)){const t=i[e];t.type===s.IdentityType.IDENTITY_TYPE_LOCAL_STORAGE&&(yield this.registerIdentityProvider(e,(()=>d.proxy.invoke("getIdentity",t))))}}}catch(e){o.error(`error checking proxy '${null===(n=this._config.property)||void 0===n?void 0:n.proxy}'`,e)}for(const e of Object.keys(i))a(e,i[e]);o.info("starting watcher"),yield this._watcher.start()}))}getIdentities(){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("getIdentities"),this._identities.isFulfilled()||(yield this.collectIdentities()),this._identities.fulfilled}))}getCurrentIdentities(){return p.default.debug("getCurrentIdentities"),this._identitiesCurrent}setJurisdiction(e){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("setJurisdiction",e),this._jurisdiction.value=e,this._jurisdiction.fulfilled}))}getJurisdiction(){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("getJurisdiction"),this._jurisdiction.fulfilled}))}setRegionInfo(e){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("setRegionInfo",e),this._regionInfo.value=e,this._regionInfo.fulfilled}))}getRegionInfo(){return o.__awaiter(this,void 0,void 0,(function*(){return p.default.debug("getRegionInfo"),this._regionInfo.fulfilled}))}getIsExperienceDisplayed(){return p.default.debug("getIsExperienceDisplayed"),this._isExperienceDisplayed}invokeRight(e){var t,n,i;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,u.wrapLogger)(p.default,"invokeRight");if(o.debug(e),!e.subject||!e.subject.email||""===e.subject.email||!e.right||""===e.right)return void o.warn("invalid right invocation request");const r={};if(this._identities.isFulfilled()&&Object.entries(this._identities.value).forEach((([e,t])=>{r[e]=t})),r.email=e.subject.email,!(this._config&&this._config.organization&&this._config.property&&this._config.environment&&this._config.jurisdiction&&this._config.rights&&0!==this._config.rights.length))return void o.warn("invalid configuration");const s=e.subject,a={organizationCode:null!==(t=this._config.organization.code)&&void 0!==t?t:"",propertyCode:null!==(n=this._config.property.code)&&void 0!==n?n:"",environmentCode:this._config.environment.code,controllerCode:"",identities:r,jurisdictionCode:null!==(i=this._config.jurisdiction.code)&&void 0!==i?i:"",rightCode:e.right,user:s,recaptchaToken:e.recaptchaToken};return this.emit(v.default.RIGHT_INVOKED_EVENT,a),this._api.invokeRight(a)}))}handleKeyboardEvent(e){(0,u.wrapLogger)(p.default,"handleKeyboardEvent").debug(e),(0,l.default)(e,(()=>{this.returnKeyboardControl()}))}returnKeyboardControl(){(0,u.wrapLogger)(p.default,"returnKeyboardControl").debug("returnKeyboardControl"),this.emit(v.default.RETURN_KEYBOARD_CONTROL)}emit(e,...t){var n,o,i,r,s;const a=(0,u.wrapLogger)(p.default,"emit");if(a.trace(e,t),window.androidListener||(null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||(null===(o=window.ReactNativeWebView)||void 0===o?void 0:o.postMessage)){const n=e.toString(),o=[];for(const e of t)e!==this&&o.push(e);let c;1===o.length&&"string"==typeof o[0]?c=o[0]:1===o.length?c=JSON.stringify(o[0]):o.length>1&&(c=JSON.stringify(o)),window.androidListener&&n in window.androidListener?(a.trace("androidListener",window.androidListener,c),0===o.length?window.androidListener[n]():window.androidListener[n](c)):(null===(i=window.webkit)||void 0===i?void 0:i.messageHandlers)&&n in window.webkit.messageHandlers?(a.trace("webkitMessageHandlers",null===(r=window.webkit)||void 0===r?void 0:r.messageHandlers,c),window.webkit.messageHandlers[n].postMessage(c)):(null===(s=window.ReactNativeWebView)||void 0===s?void 0:s.postMessage)?window.ReactNativeWebView.postMessage(JSON.stringify({event:e,data:c})):a.warn(`Can't pass message to native code because "${n}" handler is not registered`)}if(this._config&&this._config.options&&this._config.options.externalListener&&window[this._config.options.externalListener]){const n=window[this._config.options.externalListener],o=e.toString(),i=[];for(const e of t)e!==this&&i.push(e);let r;1===i.length&&"string"==typeof i[0]||1===i.length?r=i[0]:i.length>1&&(r=i);let s={event:o,data:r};s=JSON.stringify(s),"function"==typeof n?n(s):"postMessage"in n&&"function"==typeof n.postMessage?n.postMessage(s):"object"==typeof n&&o in n&&("function"===n[o]?n[o](r):"postMessage"in n[o]&&n[o].postMessage(r))}return super.emit(e,...t)}addListener(e,t){return this.on(e,t)}on(e,t){p.default.trace("on",e,t);const n=this.mapEvent(e);return void 0!==n?(n.on(v.default.FULFILLED_EVENT,t),this):(this.isSingletonEvent(e)&&super.removeAllListeners(e),super.on(e,t),this.emit("addedListener",e,t),this)}once(e,t){p.default.trace("once",e,t);const n=this.mapEvent(e);return void 0!==n?(n.once(v.default.FULFILLED_EVENT,t),this):(this.isSingletonEvent(e)&&super.removeAllListeners(e),super.once(e,t),this.emit("addedListener",e,t),this)}removeListener(e,t){p.default.trace("off",e,t);const n=this.mapEvent(e);return void 0!==n?(n.removeListener(v.default.FULFILLED_EVENT,t),this):super.removeListener(e,t)}off(e,t){return this.removeListener(e,t)}isSingletonEvent(e){return e===v.default.SHOW_CONSENT_EXPERIENCE_EVENT||e===v.default.SHOW_PREFERENCE_EXPERIENCE_EVENT}mapEvent(e){switch(e){case v.default.CONSENT_EVENT:return this._consent;case v.default.ENVIRONMENT_EVENT:return this._environment;case v.default.GEOIP_EVENT:return this._geoip;case v.default.HANDLE_KEYBOARD_EVENT:return this._handleKeyboardEvent;case v.default.IDENTITIES_EVENT:return this._identities;case v.default.JURISDICTION_EVENT:return this._jurisdiction;case v.default.REGION_INFO_EVENT:return this._regionInfo;case v.default.RETURN_KEYBOARD_CONTROL:return this._returnKeyboardControl;case v.default.SUBSCRIPTIONS_EVENT:return this._subscriptions;case v.default.SUBSCRIPTION_CONFIG_EVENT:return this._subscriptionConfig}}}t.Ketch=y},3004:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=o.__importDefault(n(7931)),r=o.__importDefault(n(5834)),s=o.__importDefault(n(8705)),a=o.__importDefault(n(6092)),c=n(5305);t.default=class{constructor(e){this._ketch=e}push(e){if(void 0===e)return;let t;"string"==typeof e?(t=e,e=[]):(e=Array.from(e),t=e.shift()),i.default.trace(t),this.route(t,...e).then((()=>{i.default.trace(`${t} completed`)})).catch((e=>{i.default.warn(`${t} failed: ${e}`)}))}route(e,...t){return o.__awaiter(this,void 0,void 0,(function*(){const n=(0,c.wrapLogger)((0,c.wrapLogger)(i.default,"route"),e);if("push"===e||"route"===e)throw r.default.actionNotFoundError(e);const o=this[e];if(void 0===o)throw r.default.actionNotFoundError(e);if(n.debug(t,t.length,o.length),t.length<=o.length)return o.apply(this,t);if(t.length==o.length+1){const n=t.pop();if(!(0,s.default)(n))throw r.default.expectedFunctionError(e);return o.apply(this,t).then(n)}const a=t.pop();if(!(0,s.default)(a))throw r.default.expectedFunctionError(e);const u=t.pop();if(!(0,s.default)(u))throw r.default.expectedFunctionError(e);return o.apply(this,t).then(u).catch(a)}))}getConfig(){return this._ketch.getConfig()}getFullConfig(){return this._ketch.getFullConfig()}getConsent(){return this._ketch.getConsent()}getEnvironment(){return this._ketch.getEnvironment()}getGeoIP(){return this._ketch.getGeoIP()}getIdentities(){return this._ketch.getIdentities()}getJurisdiction(){return this._ketch.getJurisdiction()}getRegionInfo(){return this._ketch.getRegionInfo()}onConsent(e){return i.default.debug(`onConsent is deprecated - use ketch("on", "${a.default.CONSENT_EVENT}", listener) instead`),this._ketch.on(a.default.CONSENT_EVENT,e),Promise.resolve()}onEnvironment(e){return i.default.debug(`onEnvironment is deprecated - use ketch("on", "${a.default.ENVIRONMENT_EVENT}", listener) instead`),this._ketch.on(a.default.ENVIRONMENT_EVENT,e),Promise.resolve()}onGeoIP(e){return i.default.debug(`onGeoIP is deprecated - use ketch("on", "${a.default.GEOIP_EVENT}", listener) instead`),this._ketch.on(a.default.GEOIP_EVENT,e),Promise.resolve()}onHideExperience(e){return i.default.debug(`onHideExperience is deprecated - use ketch("on", "${a.default.HIDE_EXPERIENCE_EVENT}", listener) instead`),this._ketch.on(a.default.HIDE_EXPERIENCE_EVENT,e),Promise.resolve()}onWillShowExperience(e){return i.default.debug('onWillShowExperience is deprecated - use ketch("on", "'+a.default.WILL_SHOW_EXPERIENCE_EVENT+'", listener) instead'),this._ketch.on(a.default.WILL_SHOW_EXPERIENCE_EVENT,e),Promise.resolve()}onIdentities(e){return i.default.debug(`onIdentities is deprecated - use ketch("on", "${a.default.IDENTITIES_EVENT}", listener) instead`),this._ketch.on(a.default.IDENTITIES_EVENT,e),Promise.resolve()}onJurisdiction(e){return i.default.debug(`onJurisdiction is deprecated - use ketch("on", "${a.default.JURISDICTION_EVENT}", listener) instead`),this._ketch.on(a.default.JURISDICTION_EVENT,e),Promise.resolve()}onRegionInfo(e){return i.default.debug(`onRegionInfo is deprecated - use ketch("on", "${a.default.REGION_INFO_EVENT}", listener) instead`),this._ketch.on(a.default.REGION_INFO_EVENT,e),Promise.resolve()}setEnvironment(e){return i.default.warn("setEnvironment is deprecated"),this._ketch.setEnvironment(e).then((()=>{}))}setGeoIP(e){return i.default.warn("setGeoIP is deprecated"),this._ketch.setGeoIP(e).then((()=>{}))}setIdentities(e){return i.default.warn("setIdentities is deprecated"),this._ketch.setIdentities(e).then((()=>{}))}setJurisdiction(e){return i.default.warn("setJurisdiction is deprecated"),this._ketch.setJurisdiction(e).then((()=>{}))}setRegionInfo(e){return i.default.warn("setRegionInfo is deprecated"),this._ketch.setRegionInfo(e).then((()=>{}))}showConsent(e){return this._ketch.showConsentExperience(e).then((()=>{}))}showPreferences(e){return this._ketch.showPreferenceExperience(e).then((()=>{}))}showProgressiveExperience(e){return o.__awaiter(this,void 0,void 0,(function*(){yield this._ketch.showProgressiveExperience(e)}))}reinit(){return this._ketch.resetConsent().then((()=>{}))}handleKeyboardEvent(e){return this._ketch.handleKeyboardEvent(e)}returnKeyboardControl(){return this._ketch.returnKeyboardControl()}registerPlugin(e,t){return this._ketch.registerPlugin(e,t)}registerIdentityProvider(e,t){return this._ketch.registerIdentityProvider(e,t)}registerExperienceServer(e){return this._ketch.registerExperienceServer(e)}registerStorageProvider(e,t){return this._ketch.registerStorageProvider(e,t)}setConsent(e,t){return this._ketch.setConsent(e,t).then((()=>{}))}showExperience(e){return this._ketch.showExperience(e)}emit(e,...t){return this._ketch.emit(e,...t),Promise.resolve()}on(e,t){return this._ketch.on(e,t),Promise.resolve()}once(e,t){return this._ketch.once(e,t),Promise.resolve()}addListener(e,t){return this._ketch.addListener(e,t),Promise.resolve()}removeListener(e,t){return this._ketch.removeListener(e,t),Promise.resolve()}off(e,t){return this._ketch.off(e,t),Promise.resolve()}removeAllListeners(e){return this._ketch.removeAllListeners(e),Promise.resolve()}}},372:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsConfig=void 0;const o=n(1635),i=o.__importDefault(n(6092)),r=o.__importDefault(n(7931)),s=n(5305),a=n(436);t.TagsConfig=[{elementName:"script",purposesAttribute:"data-purposes",requiredAttributeValues:{type:"text/plain"},enableActions:{attributeValueSwaps:{type:"text/javascript"}}},{elementName:"iframe",purposesAttribute:"data-purposes",requiredAttributes:["data-src"],enableActions:{attributeNameSwaps:{"data-src":"src"}}},{elementName:"script",requiredAttributes:["data-ketch-id"],requiredAttributeValues:{type:"text/plain"},enableActions:{attributeValueSwaps:{type:"text/javascript"}},isPlatformMapped:!0}],t.default=class{constructor(e,t,n){this._results={},this.getMappedElements=(e,t,n,o,i=!1)=>{const a=(0,s.wrapLogger)(r.default,"tags: getMappedElements"),c=document.querySelectorAll(e),u=Array.from(c).filter((e=>{const r=!!t&&e.hasAttribute(t),s=i&&e.hasAttribute("data-ketch-id"),a=!n||(null==n?void 0:n.every((t=>e.hasAttribute(t)))),c=!o||Object.entries(o).every((([t,n])=>e.getAttribute(t)===n));return(r||s)&&a&&c}));return a.debug(`found ${u.length} '${e}' elements mapped to ketch purposes`),u},this.enableElement=(e,t={},n={})=>{let o;return(0,s.wrapLogger)(r.default,"tags: enableElement").debug("enabling element",e),Object.entries(t).forEach((([t,n])=>{const o=e.getAttribute(t);o&&(e.setAttribute(n,o),e.removeAttribute(t))})),Object.entries(n).forEach((([t,n])=>{var i;o=e.cloneNode(!0),o.setAttribute(t,n),null===(i=e.parentNode)||void 0===i||i.replaceChild(o,e)})),null!=o?o:e},this.getGrantedPurposes=()=>o.__awaiter(this,void 0,void 0,(function*(){const e=(0,s.wrapLogger)(r.default,"tags: getGrantedPurposes"),t=yield this._ketch.getConsent(),n=(null==t?void 0:t.purposes)||{};return e.debug("got consent purposes",n),new Set(Object.keys(n).filter((e=>!0===n[e])))})),this.getRequiredPurposes=(e,t,n=!1)=>{var o,i,a;const c=(0,s.wrapLogger)(r.default,"tags: getRequiredPurposes");if(n){const t=e.getAttribute("data-ketch-id")||"";return(null===(i=null===(o=this._config.tags)||void 0===o?void 0:o[t])||void 0===i?void 0:i.purposeCodes)||[]}return t?(null===(a=e.getAttribute(t))||void 0===a?void 0:a.split(" "))||[]:(c.error("No purposes attribute for element: ",e),[])},this.execute=()=>o.__awaiter(this,void 0,void 0,(function*(){const e=(0,s.wrapLogger)(r.default,"tags: execute"),t=yield this.getGrantedPurposes();return e.debug("granted purposes",t),this._tagsConfig.forEach((n=>o.__awaiter(this,void 0,void 0,(function*(){var o,i;const{elementName:r,purposesAttribute:s,requiredAttributes:a,requiredAttributeValues:c,enableActions:{attributeNameSwaps:u,attributeValueSwaps:d},isPlatformMapped:l}=n,f=this.getMappedElements(r,s,a,c,l),p=f.filter((n=>{const o=this.getRequiredPurposes(n,s,l),i=l&&!o.length;return e.debug("required purposes for element",n,o),!(!i&&!o.some((e=>t.has(e)))||(this.enableElement(n,u,d),0))})),h=f.filter((e=>!this.getRequiredPurposes(e,s,l).some((e=>t.has(e))))),_=(null===(o=this._results[r])||void 0===o?void 0:o.enabledElements)||[],g=((null===(i=this._results[r])||void 0===i?void 0:i.disabledElements)||[]).filter((e=>!_.includes(e)&&!p.includes(e)));this._results[r]={enabledElements:[..._,...p],disabledElements:[...g.filter((e=>!h.includes(e))),...h]},e.debug(`enabled ${r} elements:`,p,`disabled ${r} elements:`,h)})))),(0,a.addToKetchLog)("getWrappedTags",(()=>{Object.entries(this._results).forEach((([e,{enabledElements:t,disabledElements:n}])=>{console.group(`%cWrapped %c<${e}>%c Tags`,"","font-family: monospace; background-color: #f4f4f4; padding: 2px 4px; border-radius: 3px; color: #333;",""),console.groupCollapsed(`%cBlocked (${n.length})`,"color: red"),n.forEach((e=>console.log(e))),console.groupEnd(),console.groupCollapsed(`%cAllowed (${t.length})`,"color: green"),t.forEach((e=>console.log(e))),console.groupEnd(),console.groupEnd()}))})),Object.values(this._results).reduce(((e,t)=>e.concat(t.enabledElements)),[])})),this._ketch=e,this._tagsConfig=t,this._config=n,this._ketch.on(i.default.CONSENT_EVENT,(()=>this.execute()))}}},532:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(8509),r=n(5305),s=o.__importDefault(n(7931)),a=o.__importDefault(n(5834)),c=n(4835),u=o.__importDefault(n(300)),d=n(4999);t.default=class{constructor(e,t){this._ketch=e,this._config=t,this._api=new d.KetchWebAPI((0,u.default)(this._config))}normalizeConsent(e,t){var n;if(!e.purposes)return e.purposes={},e;for(const o of Object.keys(e.purposes)){const i=e.purposes[o];"string"==typeof i&&(e.purposes[o]={allowed:i,legalBasisCode:null===(n=t.purposes[o])||void 0===n?void 0:n.legalBasisCode})}return e}enableAllConsent(){var e,t,n;return o.__awaiter(this,void 0,void 0,(function*(){const o=(0,r.wrapLogger)(s.default,"trackers: enableAllConsent");if(this._ketch.hasConsent())return o.trace("trackers: has consent"),this._ketch.getConsent();o.debug("trackers: obtaining and setting consent");const u=yield this._ketch.getIdentities();if(o.debug("trackers: identities",u),!u||0===Object.keys(u).length)throw a.default.noIdentitiesError;if(!(this._config&&this._config.property&&this._config.organization&&this._config.environment&&this._config.purposes&&this._config.jurisdiction&&0!==this._config.purposes.length))throw a.default.noPurposesError;const d={organizationCode:null!==(e=this._config.organization.code)&&void 0!==e?e:"",propertyCode:null!==(t=this._config.property.code)&&void 0!==t?t:"",environmentCode:this._config.environment.code,jurisdictionCode:null!==(n=this._config.jurisdiction.code)&&void 0!==n?n:"",identities:u,purposes:{}};for(const e of this._config.purposes)d.purposes[e.code]={legalBasisCode:e.legalBasisCode};o.debug("trackers: calling getConsent",d);const l=this.normalizeConsent(yield this._api.getConsent(d),d);o.debug("trackers: getConsent returned",l),yield(0,c.setCachedConsent)(l,this._config),yield(0,c.setPublicConsent)(l,this._config);const f={purposes:{}};if(null==l?void 0:l.purposes)for(const[e]of Object.entries(l.purposes))f.purposes[e]=!0;return l.vendors&&(f.vendors=l.vendors),l.googleVendors&&(f.googleVendors=l.googleVendors),l.protocols&&(f.protocols=l.protocols),o.debug("trackers: newConsent",f),yield this._ketch.setConsent(f,i.SetConsentReason.USER_UPDATE),f}))}}},8773:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.boot=void 0;const o=n(1635),i=o.__importDefault(n(8347)),r=o.__importDefault(n(7931)),s=o.__importDefault(n(2774));t.boot=function(){return o.__awaiter(this,void 0,void 0,(function*(){window.semaphore=window.semaphore||[],window.ketch=window.ketch||s.default;const e=()=>o.__awaiter(this,void 0,void 0,(function*(){try{yield(0,i.default)()}catch(e){r.default.error(e)}}));"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):yield e()}))}},4835:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCacheEntry=t.getCacheEntry=t.clearCacheEntry=t.setCachedNavNode=t.getCachedNavNode=t.getLanyardRoot=t.setPublicConsent=t.setCachedConsent=t.getCachedConsent=t.KEYBOARD_HANDLER_CACHE_KEYS=t.PUBLIC_CONSENT_TTL=t.CACHED_CONSENT_TTL=t.CACHED_PROTOCOLS_KEY=t.PUBLIC_CONSENT_KEY_V1=t.CACHED_CONSENT_KEY=void 0;const o=n(1635),i=n(9791),r=n(835),s=n(5305),a=o.__importDefault(n(7931)),c=n(6092),u=n(7296);t.CACHED_CONSENT_KEY="_swb_consent_",t.PUBLIC_CONSENT_KEY_V1="_ketch_consent_v1_",t.CACHED_PROTOCOLS_KEY="_swb_consent_",t.CACHED_CONSENT_TTL=300,t.PUBLIC_CONSENT_TTL=3456e4,t.KEYBOARD_HANDLER_CACHE_KEYS={CTX_KEY:"_ketch_currentKeyboardCtx",LANYARD_DOM:"_ketch_lanyardRootDom",FOCUSABLE_ELEMS:"_ketch_focusableElems",MODAL_STACKS:"_ketch_modalStacks",SUB_EXPERIENCE_CTX:"_ketch_subExperienceCtx"};const d=(0,i.getDefaultCacher)(),l=new i.WebStorageCacher(window.localStorage,86400);function f(e){return window&&window[e]||localStorage&&localStorage.getItem(e)}function p(e,t){localStorage&&localStorage.setItem(e,t),window&&(window[e]=t)}t.getCachedConsent=function(e,n){return o.__awaiter(this,void 0,void 0,(function*(){const o={organizationCode:e.organizationCode,propertyCode:e.propertyCode,environmentCode:e.environmentCode,jurisdictionCode:e.jurisdictionCode,identities:e.identities,purposes:{},collectedAt:0};if(n.options&&"no-cache"===n.options["Cache-Control"])return o;const i=yield d.getItem(t.CACHED_CONSENT_KEY);if(!i)return o;if(0===Object.keys(i).length)return o;if(!i.collectedAt)return o;const r=i,s=yield l.getItem(t.CACHED_PROTOCOLS_KEY);return r.vendors=null==s?void 0:s.vendors,r.googleVendors=null==s?void 0:s.googleVendors,r.protocols=null==s?void 0:s.protocols,r}))},t.setCachedConsent=function(e,n){return o.__awaiter(this,void 0,void 0,(function*(){if(!e||0===Object.keys(e).length)return;e.collectedAt=Math.floor(Date.now()/1e3);const o=Object.assign({},e);yield l.setItem(t.CACHED_PROTOCOLS_KEY,o),o.vendors=void 0,o.googleVendors=void 0,"protocols"in o&&(o.protocols=void 0),n.options&&"true"===n.options.cache_cookies_disabled||(yield d.setItem(t.CACHED_CONSENT_KEY,o))}))},t.setPublicConsent=function(e,n){return o.__awaiter(this,void 0,void 0,(function*(){if(0===Object.keys(e).length)return;const o={};if(n.purposes){for(const t of n.purposes){if(!Object.prototype.hasOwnProperty.call(e.purposes,t.code))continue;const n=e.purposes[t.code];let i="";"string"==typeof n?i="true"===n?"granted":"denied":n.allowed&&(i="true"===n.allowed?"granted":"denied"),0!=i.length&&(o[t.code]={status:i},t.canonicalPurposeCodes?o[t.code].canonicalPurposes=t.canonicalPurposeCodes:t.canonicalPurposeCode&&t.canonicalPurposeCode.length>0&&(o[t.code].canonicalPurposes=[t.canonicalPurposeCode]))}if(Object.keys(o).length>0){const e=btoa(JSON.stringify(o));null===localStorage||void 0===localStorage||localStorage.setItem(t.PUBLIC_CONSENT_KEY_V1,e),(0,r.setCookie)(window,t.PUBLIC_CONSENT_KEY_V1,e,t.PUBLIC_CONSENT_TTL)}}}))},t.getLanyardRoot=function(){if(window&&window[t.KEYBOARD_HANDLER_CACHE_KEYS.LANYARD_DOM])return window[t.KEYBOARD_HANDLER_CACHE_KEYS.LANYARD_DOM];{const e=document.getElementById(c.LANYARD_ID);return window&&(window[t.KEYBOARD_HANDLER_CACHE_KEYS.LANYARD_DOM]=e),e}},t.getCachedNavNode=function(e,t={}){const n=(0,s.wrapLogger)(a.default,"getCachedDomNode");if(!window&&!localStorage)return n.debug("missing storage options"),null;const o=f(e);return o?(0,u.decodeDataNav)(o):(n.debug("cache missing key: ",e),t.ifNull?(n.debug("populating cache"),p(e,t.ifNull),(0,u.decodeDataNav)(t.ifNull)):null)},t.setCachedNavNode=function(e,t){const n=(0,s.wrapLogger)(a.default,"setCachedNavNode"),o=t.src;o?p(e,o):n.debug(`Missing data nav encoding. Cannot cache ${e}`)},t.clearCacheEntry=function(e){window&&(window[e]=void 0),localStorage&&localStorage.removeItem(e)},t.getCacheEntry=f,t.setCacheEntry=p},6092:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANYARD_ID=t.EMPTY_CONSENT=void 0,t.default=Object.assign(Object.assign({},{CONSENT_EVENT:"consent",ENVIRONMENT_EVENT:"environment",FULFILLED_EVENT:"fulfilled",GEOIP_EVENT:"geoip",HANDLE_KEYBOARD_EVENT:"handleKeyboardEvent",HAS_CHANGED_EXPERIENCE_EVENT:"hasChangedExperience",HAS_SHOWN_EXPERIENCE_EVENT:"hasShownExperience",HIDE_EXPERIENCE_EVENT:"hideExperience",IDENTITIES_EVENT:"identities",IDENTITY_EVENT:"identity",JURISDICTION_EVENT:"jurisdiction",PROTOCOLS_EVENT:"protocols",REGION_INFO_EVENT:"regionInfo",RETURN_KEYBOARD_CONTROL:"returnKeyboardControl",RIGHT_INVOKED_EVENT:"rightInvoked",SHOW_CONSENT_EXPERIENCE_EVENT:"showConsentExperience",SHOW_PREFERENCE_EXPERIENCE_EVENT:"showPreferenceExperience",SHOW_PROGRESSIVE_EXPERIENCE_EVENT:"showProgressiveExperience",SUBSCRIPTIONS_EVENT:"subscriptions",SUBSCRIPTION_CONFIG_EVENT:"subscriptionConfig",USER_CONSENT_UPDATED_EVENT:"userConsentUpdated",WILL_CHANGE_EXPERIENCE_EVENT:"willChangeExperience",WILL_SHOW_EXPERIENCE_EVENT:"willShowExperience"}),{NONE:"none",ENV:"env",PRODUCTION:"production",REGION:"region",JURISDICTION:"jurisdiction",LANGUAGE:"lang",SHOW:"show",PREFERENCES_TAB:"preferences_tab",PREFERENCES_TABS:"preferences_tabs",CONSENT:"cd",PREFERENCES:"preferences",API_SERVER:"shoreline",API_SERVER_BASE_URL:"https://web.archive.org/web/20241106083957/https://global.ketchcdn.com/web/v2",EXPERIENCE_VERSION:"experience_version"}),t.EMPTY_CONSENT={purposes:{},vendors:[],googleVendors:[],protocols:{}},t.LANYARD_ID="lanyard_root"},192:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return window.dataLayer=window.dataLayer||[]}},5834:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={actionNotFoundError:e=>new Error(`action "${e}" not found`),expectedFunctionError:e=>new Error(`action "${e}" expected a function`),unrecognizedLocationError:new Error("unrecognized location"),noIdentitiesError:new Error("no identities"),noPurposesError:new Error("no purposes"),noEnvironmentError:new Error("no environment"),noJurisdictionError:new Error("no jurisdiction"),invalidConfigurationError:new Error("invalid configuration"),emptyConsentError:new Error("empty consent")}},300:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=o.__importDefault(n(6092)),r=o.__importDefault(n(3449));t.default=function(e){if(e.services){let t=e.services[i.default.API_SERVER];t.endsWith("/")&&(t=t.slice(0,-1));const n=r.default.get(i.default.EXPERIENCE_VERSION);return n&&(t.includes("v3")&&"old"===n?t=t.replace("v3","v2"):t.includes("v2")&&"new"===n&&(t=t.replace("v2","v3"))),t.endsWith("/web/v2")||t.endsWith("/web/v3")||(t+="/web/v2"),t}return i.default.API_SERVER_BASE_URL}},549:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ketch=t.boot=void 0;const o=n(5926);Object.defineProperty(t,"Ketch",{enumerable:!0,get:function(){return o.Ketch}});const i=n(8773);Object.defineProperty(t,"boot",{enumerable:!0,get:function(){return i.boot}})},8347:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=o.__importDefault(n(7931)),r=o.__importDefault(n(5250)),s=o.__importDefault(n(3004)),a=o.__importDefault(n(532)),c=o.__importStar(n(372)),u=o.__importDefault(n(2433));t.default=function(){var e;return o.__awaiter(this,void 0,void 0,(function*(){const t=window.semaphore||[],n=t.shift();if(!Array.isArray(n)||2!=n.length||"init"!=n[0])throw Error("ketch tag command queue is not configured correctly");const o=n[1];i.default.debug("init",o);const d=new r.default(o),l=yield d.build(),f=new s.default(l);for(;t.length>0;)f.push(t.shift());window.semaphore.push=f.push.bind(f),window.semaphore.loaded=!0;const p=yield l.getConfig();if(null===(e=null===window||void 0===window?void 0:window.localStorage)||void 0===e?void 0:e.getItem("overrideConsent")){const e=new a.default(l,p);yield e.enableAllConsent()}else yield l.getConsent();new c.default(l,c.TagsConfig,p).execute(),new u.default(l,p).execute()}))}},3044:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}},8705:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},2774:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,...t){(window.semaphore=window.semaphore||[]).push([e,...t])}},7262:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleNavigation=t.navigateBannerTree=t.getBannerTree=t.navigateModalStacks=t.handleDisabledSwitches=t.getModalStacks=t.getStaticModalNodes=t.handleSelection=t.handleSubExperienceCaching=t.renderNavigation=t.clearCachedNodes=t.getArrowActionFromUserAgent=t.getUserAgent=void 0;const o=n(1635),i=n(5305),r=n(4835),s=n(9305),a=o.__importDefault(n(7931)),c=n(7296);t.getUserAgent=()=>{const e=(0,i.wrapLogger)(a.default,"getUserAgent"),t=navigator.userAgent.toUpperCase();return Object.values(s.SupportedUserAgents).find((e=>-1!==t.search(e)))||void e.debug(`Unsupported userAgent: ${t}`)},t.getArrowActionFromUserAgent=e=>{const n=(0,i.wrapLogger)(a.default,"getArrowActionFromUserAgent"),o=(0,t.getUserAgent)();if(!o)return n.debug(`Unknown userAgent: ${navigator.userAgent}`),s.ArrowActions.UNKNOWN;const r=s.UserAgentHandlerMap[o];return r?r[e.keyCode]?r[e.keyCode]:(n.debug(`Unknown key: ${e.keyCode}`),s.ArrowActions.UNKNOWN):(n.debug(`Misconfigured userAgent: ${o}`),s.ArrowActions.UNKNOWN)},t.clearCachedNodes=()=>{const e=(0,i.wrapLogger)(a.default,"clearCachedNodes");Object.values(r.KEYBOARD_HANDLER_CACHE_KEYS).forEach((t=>{e.trace(`clearing ${t}`),(0,r.clearCacheEntry)(t)}))},t.renderNavigation=e=>{const t=(0,i.wrapLogger)(a.default,"renderNavigation"),n=(0,r.getLanyardRoot)();if(!n)return void t.debug("missing lanyard root");const{prev:o,next:s}=e;if(o){const e=n.querySelector(`[data-nav="${o.src}"]`);e?e.blur():t.debug(`node not found: ${o.src} -- ${o["nav-index"]}`)}if(s){const e=n.querySelector(`[data-nav="${s.src}"]`);e?e.focus():t.debug(`node not found: ${s.src} -- ${s["nav-index"]}`)}},t.handleSubExperienceCaching=(e,t)=>{const n=(0,r.getCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.SUB_EXPERIENCE_CTX);if(n||e.action!==s.LanyardItemActions.expand){if(e.action===s.LanyardItemActions.expand&&n===e.subExperience)(0,r.clearCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.SUB_EXPERIENCE_CTX);else if(e.action===s.LanyardItemActions.switch&&n===e.subExperience){const e=t.find((e=>e.subExperience===n&&e.action===s.LanyardItemActions.expand)),o=e&&(0,c.getDomNode)(e);o&&"function"==typeof o.click&&o.click(),(0,r.clearCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.SUB_EXPERIENCE_CTX)}else if(n!==e.subExperience&&e.action===s.LanyardItemActions.expand){const o=t.find((e=>e.subExperience===n&&e.action===s.LanyardItemActions.expand)),i=o&&(0,c.getDomNode)(o);i&&"function"==typeof i.click&&i.click(),(0,r.setCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.SUB_EXPERIENCE_CTX,e.subExperience)}}else(0,r.setCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.SUB_EXPERIENCE_CTX,e.subExperience)},t.handleSelection=(e=!0,n)=>{const o=(0,i.wrapLogger)(a.default,"handleSelection"),s=(0,r.getCachedNavNode)(r.KEYBOARD_HANDLER_CACHE_KEYS.CTX_KEY),u=(0,c.getDomNode)(s);s&&u&&"function"==typeof u.click?(e&&(0,t.clearCachedNodes)(),Array.isArray(n)&&s.subExperience&&(0,t.handleSubExperienceCaching)(s,n),u.click()):o.debug("Node missing or missing click fn",u)},t.getStaticModalNodes=e=>{const t=(0,i.wrapLogger)(a.default,"getStaticModalNodes");if(0===e.length)return t.debug("no clickable nodes"),{topNodes:[]};const n=(0,c.safeJsonParse)((0,r.getCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.MODAL_STACKS));if(n&&Array.isArray(n.topNodes))return n;const o=e.filter((e=>void 0===e.subExperience)).sort(((e,t)=>e["nav-index"]-t["nav-index"]));t.trace("top nodes:",o);const u=e.filter((e=>e.subExperience&&e.action===s.LanyardItemActions.expand)).sort(((e,t)=>void 0===e.subExperience||void 0===t.subExperience?0:e.subExperience.localeCompare(t.subExperience)));t.trace("expand nodes:",u);const d=e.filter((e=>e.subExperience&&e.action===s.LanyardItemActions.switch)).sort(((e,t)=>void 0===e.subExperience||void 0===t.subExperience?0:e.subExperience.localeCompare(t.subExperience)));t.trace("switch nodes:",d);const l={expandNodes:u.length>0?u:void 0,switchNodes:d.length>0?d:void 0,topNodes:o};return(0,r.setCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.MODAL_STACKS,JSON.stringify(l)),l},t.getModalStacks=e=>{const n=(0,i.wrapLogger)(a.default,"getModalStacks"),o=(0,t.getStaticModalNodes)(e);Array.isArray(o.topNodes)&&0!==o.topNodes.length||n.debug("Missing top nodes in the stack");const s=(0,r.getCacheEntry)(r.KEYBOARD_HANDLER_CACHE_KEYS.SUB_EXPERIENCE_CTX);if(s){if(n.trace("existing subExperienceCtx:",s),!o.expandNodes||0===o.expandNodes.length)return n.debug(`missing expand nodes for ${s}. Returning without subExperience`),o;const t=e.filter((e=>e.subExperience===s)).sort(((e,t)=>e["nav-index"]-t["nav-index"]));n.trace(`found ${t.length} nodes in ${s}`);const i=o.expandNodes.findIndex((e=>e.subExperience===s));if(-1===i)return n.debug(`Expand nodes missing for ${s}. Returning stacks without subExperience`),o;o.expandNodes=[...o.expandNodes.slice(0,i),...t,...o.expandNodes.slice(i+1)],n.trace("updating expand nodes",o.expandNodes)}return o},t.handleDisabledSwitches=(e,t)=>{if(e.action===s.LanyardItemActions.switch&&e.disabled){const n=null==t?void 0:t.find((t=>t.subExperience===e.subExperience));if(n)return n}return e},t.navigateModalStacks=(e,n,o)=>{var c,u,d;const l=(0,i.wrapLogger)(a.default,"navigateModalStacks");if(!e||!e.topNodes||!(null===(c=e.topNodes)||void 0===c?void 0:c.length))return l.debug("no top nodes found in the modal"),null;if(null===o)return l.debug(`Defaulting first selection to node: ${e.topNodes[0]}`),e.topNodes[0];const f=o.action,p=f===s.LanyardItemActions.switch?e.switchNodes:f===s.LanyardItemActions.expand||o.subExperience?e.expandNodes:e.topNodes;if(!p)return l.debug("Storage inconsistent"),null;l.trace("activeStack:",p);const h=p.findIndex((e=>e.src===o.src));l.trace(`moving ${n} from index ${h}`);let _=null;switch(n){case s.ArrowActions.UP:if(0===h){if(f===s.LanyardItemActions.expand||f===s.LanyardItemActions.switch){_=e.topNodes[e.topNodes.length-1];break}{const t=e.switchNodes||e.expandNodes;_=t&&t.length>0?t[t.length-1]:null;break}}_=p[h-1];break;case s.ArrowActions.DOWN:if(h===p.length-1){if(f===s.LanyardItemActions.expand||f===s.LanyardItemActions.switch){_=e.topNodes[0];break}{const t=e.switchNodes||e.expandNodes;_=t&&t.length>0?t[0]:null;break}}_=p[h+1];break;case s.ArrowActions.LEFT:f===s.LanyardItemActions.switch&&(_=null===(u=e.expandNodes)||void 0===u?void 0:u.find((e=>e.subExperience===o.subExperience)));break;case s.ArrowActions.RIGHT:f===s.LanyardItemActions.expand&&(_=null===(d=e.switchNodes)||void 0===d?void 0:d.find((e=>e.subExperience===o.subExperience)));break;case s.ArrowActions.OK:const n=o.action===s.LanyardItemActions.confirm||o.action===s.LanyardItemActions.close||o.action===s.LanyardItemActions.back||Boolean(o.clearCache);(0,t.handleSelection)(n,e.expandNodes);break;case s.ArrowActions.BACK:const i=e.topNodes.find((e=>e.action===s.LanyardItemActions.back));i&&((0,r.setCachedNavNode)(r.KEYBOARD_HANDLER_CACHE_KEYS.CTX_KEY,i),(0,t.handleSelection)(!0));break;default:return null}return _?(0,t.handleDisabledSwitches)(_,e.expandNodes):null},t.getBannerTree=e=>{const t=(0,i.wrapLogger)(a.default,"getBannerTree");if(0===e.length)return t.debug("no clickable nodes"),[];const n=e.sort(((e,t)=>e["nav-index"]-t["nav-index"]));return t.debug(n),n},t.navigateBannerTree=(e,n,o)=>{const r=(0,i.wrapLogger)(a.default,"navigateBannerTree");if(null===o)return r.debug(`Defaulting first selection to node: ${e[0]}`),e[0];const c=e.findIndex((e=>e.src===o.src));switch(r.debug("Starting at: ",c),n){case s.ArrowActions.UP:case s.ArrowActions.LEFT:return 0===c?(r.debug("Cannot move past last node"),null):e[c-1];case s.ArrowActions.RIGHT:case s.ArrowActions.DOWN:return c===e.length-1?(r.debug("Cannot move beyond first node"),null):e[c+1];case s.ArrowActions.OK:return(0,t.handleSelection)(!0),null;case s.ArrowActions.BACK:return r.trace("cannot back out of banner"),null;default:return r.debug("Unknown arrowAction: ",n),null}},t.handleNavigation=e=>{const n=(0,i.wrapLogger)(a.default,"handleNavigation");n.debug("Navigating ",e);const o=(0,r.getLanyardRoot)();if(null===o)return n.debug("Cannot find lanyard root"),null;if(!(o instanceof HTMLElement))return n.debug("Storage inconsistent"),null;const u=o.querySelectorAll("[data-nav]");if(!u||0===u.length)return n.debug("No tagged DOM nodes found"),null;const d=[];u.forEach((e=>{const t=(0,c.decodeDataNav)(e.dataset.nav||"");null!==t&&d.push(t)})),d.length!==u.length?n.debug("inconsistent encoding of data-nav"):window.decodedNodes=d;let l=null;const f=d[0].experience,p=(0,r.getCachedNavNode)(r.KEYBOARD_HANDLER_CACHE_KEYS.CTX_KEY);if(f===s.EXPERIENCES.BANNER){const n=(0,t.getBannerTree)(d);l=(0,t.navigateBannerTree)(n,e,p)}else if(f===s.EXPERIENCES.MODAL){const n=(0,t.getModalStacks)(d);l=(0,t.navigateModalStacks)(n,e,p)}else n.debug(`unhandled experience ${f}`);return l&&(n.debug("Updating cached context node: ",l),(0,r.setCachedNavNode)(r.KEYBOARD_HANDLER_CACHE_KEYS.CTX_KEY,l)),{prev:p,next:l}},t.default=function(e,n){const o=(0,i.wrapLogger)(a.default,"onKeyPress"),r="string"==typeof e?e:(0,t.getArrowActionFromUserAgent)(e);if(o.debug("Processing movement: ",r),r===s.ArrowActions.UNKNOWN){const i="string"==typeof e?e:e.keyCode;o.error(`Unknown input: ${i}`),o.debug("returning keyboard control"),(0,t.clearCachedNodes)(),n()}else{const e=(0,t.handleNavigation)(r);e?(0,t.renderNavigation)(e):(o.debug("returning keyboard control"),(0,t.clearCachedNodes)(),n())}}},9305:(e,t)=>{"use strict";var n,o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.UserAgentHandlerMap=t.SupportedUserAgents=t.LanyardItemActions=t.EXPERIENCES=t.ArrowActions=void 0,function(e){e.LEFT="LEFT",e.RIGHT="RIGHT",e.UP="UP",e.DOWN="DOWN",e.BACK="BACK",e.OK="OK",e.UNKNOWN="UNKNOWN"}(n=t.ArrowActions||(t.ArrowActions={})),t.EXPERIENCES={BANNER:"ketch-consent-banner",MODAL:"ketch-purpose-modal",PREFERENCES:"ketch-preferences"},(i=t.LanyardItemActions||(t.LanyardItemActions={})).back="back",i.close="close",i.confirm="confirm",i.expand="expand",i.switch="switch",function(e){e.TIZEN="TIZEN",e.MACINTOSH="MACINTOSH"}(o=t.SupportedUserAgents||(t.SupportedUserAgents={}));const r={37:n.LEFT,38:n.UP,39:n.RIGHT,40:n.DOWN,13:n.OK,10009:n.BACK},s={37:n.LEFT,38:n.UP,39:n.RIGHT,40:n.DOWN,13:n.OK,27:n.BACK};t.UserAgentHandlerMap={[o.TIZEN]:r,[o.MACINTOSH]:s}},7931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5305);let i=(0,o.getLogLevel)((0,o.getParams)(window.location.search,["ketch_","swb_"]));t.default=(0,o.getLogger)("ketch",i)},3449:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=(0,n(5305).getParams)(window.location.search,["ketch_","swb_"]);t.default=o},7296:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.santizePaths=t.getDomNode=t.decodeDataNav=t.safeJsonParse=void 0;const o=n(1635),i=n(5305),r=o.__importDefault(n(7931)),s=n(4835);function a(e){const t=(0,i.wrapLogger)(r.default,"safeJsonParse");if(!e||""===e.trim())return{};try{return JSON.parse(e)}catch(n){return t.error(`Could not parse JSON for ${e} - ${n}`),null}}t.safeJsonParse=a,t.decodeDataNav=function(e){const t=(0,i.wrapLogger)(r.default,"decodeDataNav");let n="";try{n=window.atob(e)}catch(n){return t.debug(`Invalid encoding: ${e}`,n),null}const o=a(n);return"[object Object]"!==Object.prototype.toString.call(o)?null:(o.src=e,o)},t.getDomNode=function(e){const t=(0,i.wrapLogger)(r.default,"convertToKetchHTMLElement");if(!e||!e.src)return t.debug("node missing src",e),null;const n=`[data-nav="${e.src}"]`,o=(0,s.getLanyardRoot)();return o?o.querySelector(n):(t.debug("missing lanyard root"),null)},t.santizePaths=function(e){return(0,i.wrapLogger)(r.default,"santizePaths").debug(`is path ${e} sane: `,/[^a-zA-Z0-9_-]/.test(e)),e.replace(/[^a-zA-Z0-9_-]/g,"")}},4999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KetchWebAPI=void 0;const o=n(1635);class i{constructor(e,t){this._baseUrl=e,this._fetch=t||n.g.fetch.bind(window)}getLocation(){return o.__awaiter(this,void 0,void 0,(function*(){return yield this.get("/ip")}))}getBootstrapConfiguration(e){return o.__awaiter(this,void 0,void 0,(function*(){return yield this.get(`/config/${e.organizationCode}/${e.propertyCode}/boot.json`)}))}getFullConfiguration(e){return o.__awaiter(this,void 0,void 0,(function*(){let t="";return this._baseUrl.includes("web/v3")?(e.environmentCode&&e.jurisdictionCode&&e.languageCode&&(t=`/${e.environmentCode}/${e.jurisdictionCode}/${e.languageCode}`),yield this.get(`/config/${e.organizationCode}/${e.propertyCode}${t}/config.json${e.hash?`?hash=${e.hash}`:""}`)):(e.environmentCode&&e.hash&&e.jurisdictionCode&&e.languageCode&&(t=`/${e.environmentCode}/${e.hash}/${e.jurisdictionCode}/${e.languageCode}`),yield this.get(`/config/${e.organizationCode}/${e.propertyCode}${t}/config.json`))}))}getSubscriptionsConfiguration(e){return o.__awaiter(this,void 0,void 0,(function*(){const{organizationCode:t,propertyCode:n,languageCode:o,experienceCode:i}=e;return yield this.get(`/config/${t}/${n}/${o}/${i}/subscriptions.json`)}))}getConsentConfiguration({organizationCode:e,propertyCode:t,envCode:n,jurisdictionCode:i,langCode:r,hash:s}){return o.__awaiter(this,void 0,void 0,(function*(){return yield this.get(`/config/${e}/${t}/${n}/${i}/${r}/consent.json${s?`?hash=${s}`:""}`)}))}getPreferenceConfiguration({organizationCode:e,propertyCode:t,envCode:n,jurisdictionCode:i,langCode:r,hash:s}){return o.__awaiter(this,void 0,void 0,(function*(){return yield this.get(`/config/${e}/${t}/${n}/${i}/${r}/preference.json${s?`?hash=${s}`:""}`)}))}getConsent(e){return o.__awaiter(this,void 0,void 0,(function*(){try{const t=yield this.post(`/consent/${e.organizationCode}/get`,e);return t&&t.purposes&&Object.keys(t.purposes).length?t:e}catch(t){return e}}))}setConsent(e){return o.__awaiter(this,void 0,void 0,(function*(){try{const t=yield this.post(`/consent/${e.organizationCode}/update`,e);return t&&t.purposes&&Object.keys(t.purposes).length?t:e}catch(t){return e}}))}getSubscriptions(e){return o.__awaiter(this,void 0,void 0,(function*(){return yield this.post(`/subscriptions/${e.organizationCode}/get`,e)}))}setSubscriptions(e){return o.__awaiter(this,void 0,void 0,(function*(){yield this.post(`/subscriptions/${e.organizationCode}/update`,e)}))}invokeRight(e){return o.__awaiter(this,void 0,void 0,(function*(){return this.post(`/rights/${e.organizationCode}/invoke`,e)}))}preferenceQR(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=new URL(`${this._baseUrl}/qr/${e.organizationCode}/${e.propertyCode}/preferences.png`);return e.environmentCode&&t.searchParams.set("env",e.environmentCode),e.imageSize&&t.searchParams.set("size",e.imageSize.toString()),e.path&&t.searchParams.set("path",e.path),e.backgroundColor&&t.searchParams.set("bgcolor",e.backgroundColor),e.foregroundColor&&t.searchParams.set("fgcolor",e.foregroundColor),Object.keys(e.parameters).forEach((n=>{t.searchParams.set(n,e.parameters[n])})),t.toString()}))}webReport(e,t){return o.__awaiter(this,void 0,void 0,(function*(){yield this.post(`/report/${e}`,t)}))}get(e){return o.__awaiter(this,void 0,void 0,(function*(){return this._fetch(this._baseUrl+e,i.fetchOptions("GET")).then((e=>e.json()))}))}post(e,t){return o.__awaiter(this,void 0,void 0,(function*(){const n=yield this._fetch(this._baseUrl+e,i.fetchOptions("POST",t));if(!n.ok)throw new Error(yield n.text());return n.json()}))}static fetchOptions(e,t){const n={method:e,mode:"cors",credentials:"omit"},o="application/json";return t?(n.body=JSON.stringify(t),n.headers={Accept:o,"Content-Type":o}):n.headers={Accept:o},n}}t.KetchWebAPI=i},3165:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.map((e=>{try{return window.atob(decodeURIComponent(e))}catch(t){return e}}))}},5962:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encoding=void 0;const o=n(1635).__importDefault(n(3165));t.encoding=o.default},4080:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(4615),r=o.__importDefault(n(7029));t.default=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){if(!e||0===t.length)return[];const n=(0,i.getCookie)(e,t);return n&&"0"!==n?[n]:(0,r.default)(e,`ketch_${t}`)}))}},7111:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCookie=t.getCookie=t.fetcher=void 0;const o=n(1635).__importDefault(n(4080));t.fetcher=o.default;const i=n(4615);Object.defineProperty(t,"getCookie",{enumerable:!0,get:function(){return i.getCookie}}),Object.defineProperty(t,"setCookie",{enumerable:!0,get:function(){return i.setCookie}})},4615:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCookie=t.getCookie=void 0;const o=n(835);Object.defineProperty(t,"getCookie",{enumerable:!0,get:function(){return o.getCookie}}),t.setCookie=function(e,t,n,i){(0,o.setCookie)(e,t,n,i?86400*i:i)}},725:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635);t.default=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){if(!e||!e.dataLayer||0===t.length)return[];let n=[];for(const o of e.dataLayer)if(Object.prototype.hasOwnProperty.call(o,t)){const e=o[t];e&&"0"!==e&&(n=n.concat(e))}return n}))}},2302:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetcher=void 0;const o=n(1635).__importDefault(n(725));t.fetcher=o.default},9220:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.semicolonStructure=t.queryStructure=t.jwtStructure=t.jsonStructure=t.stringStructure=t.managedFetcher=t.queryStringFetcher=t.sessionStorageFetcher=t.localStorageFetcher=t.windowFetcher=t.dataLayerFetcher=t.setCookie=t.getCookie=t.cookieFetcher=void 0;const o=n(1635),i=n(7111);Object.defineProperty(t,"cookieFetcher",{enumerable:!0,get:function(){return i.fetcher}}),Object.defineProperty(t,"getCookie",{enumerable:!0,get:function(){return i.getCookie}}),Object.defineProperty(t,"setCookie",{enumerable:!0,get:function(){return i.setCookie}});const r=n(2302);Object.defineProperty(t,"dataLayerFetcher",{enumerable:!0,get:function(){return r.fetcher}});const s=n(3841);Object.defineProperty(t,"windowFetcher",{enumerable:!0,get:function(){return s.fetcher}});const a=n(3861);Object.defineProperty(t,"localStorageFetcher",{enumerable:!0,get:function(){return a.fetcher}});const c=n(6944);Object.defineProperty(t,"sessionStorageFetcher",{enumerable:!0,get:function(){return c.fetcher}});const u=n(4334);Object.defineProperty(t,"queryStringFetcher",{enumerable:!0,get:function(){return u.fetcher}});const d=n(9694);Object.defineProperty(t,"managedFetcher",{enumerable:!0,get:function(){return d.fetcher}});const l=n(164);Object.defineProperty(t,"stringStructure",{enumerable:!0,get:function(){return l.structure}});const f=n(659);Object.defineProperty(t,"jsonStructure",{enumerable:!0,get:function(){return f.structure}});const p=n(7510);Object.defineProperty(t,"jwtStructure",{enumerable:!0,get:function(){return p.structure}});const h=n(4334);Object.defineProperty(t,"queryStructure",{enumerable:!0,get:function(){return h.structure}});const _=n(4774);Object.defineProperty(t,"semicolonStructure",{enumerable:!0,get:function(){return _.structure}});const g=o.__importDefault(n(1031));t.default=g.default},659:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.structure=void 0;const o=n(1635).__importDefault(n(5062));t.structure=o.default},5062:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if("object"==typeof e&&!Array.isArray(e)&&null!==e)return e;const t=JSON.parse(e);return"object"!=typeof t||Array.isArray(t)||null===t?{value:t}:t}},7510:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.structure=void 0;const o=n(1635).__importDefault(n(2971));t.structure=o.default},2971:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.split(".")[1],n=atob(t);return JSON.parse(n)}},206:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(6590);t.default=(0,o.fetcher)("localStorage")},3861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetcher=void 0;const o=n(1635).__importDefault(n(206));t.fetcher=o.default},9573:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(835),r=n(2831);t.default=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){if(!e||0===t.length)return[];t="_swb";let n=(0,i.getCookie)(e,t);return n?[n]:((0,i.setCookie)(e,t,(0,r.v4)(),63072e3),n=(0,i.getCookie)(e,t),n?[n]:[])}))}},9694:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetcher=void 0;const o=n(1635).__importDefault(n(9573));t.fetcher=o.default},9528:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e}},2193:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encoding=void 0;const o=n(1635).__importDefault(n(9528));t.encoding=o.default},7029:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635);t.default=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){return e&&e.location&&0!==e.location.search.length&&0!==t.length?new URLSearchParams(e.location.search).getAll(t).filter((e=>"0"!==e)):[]}))}},4334:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.structure=t.fetcher=void 0;const o=n(1635),i=o.__importDefault(n(7029));t.fetcher=i.default;const r=o.__importDefault(n(3091));t.structure=r.default},3091:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};for(const[n,o]of new URLSearchParams(e).entries())t[n]=o;return t}},4774:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.structure=void 0;const o=n(1635).__importDefault(n(955));t.structure=o.default},955:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.split(";").map((e=>e.trim().split("="))),n={};for(const[e,o]of t)n[decodeURIComponent(e)]=decodeURIComponent(o);return n}},5063:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(6590);t.default=(0,o.fetcher)("sessionStorage")},6944:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetcher=void 0;const o=n(1635).__importDefault(n(5063));t.fetcher=o.default},1669:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635);t.default=function(e){return function(t,n){return o.__awaiter(this,void 0,void 0,(function*(){if(!t||0===n.length)return[];try{const o=("localStorage"===e?t.localStorage:t.sessionStorage).getItem(n);return o&&"0"!==o?[o]:[]}catch(e){return[]}}))}}},6590:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetcher=void 0;const o=n(1635).__importDefault(n(1669));t.fetcher=o.default},164:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.structure=void 0;const o=n(1635).__importDefault(n(8805));t.structure=o.default},8805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{value:e}}},1031:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635),i=n(7007),r=n(8509),s=n(7111),a=n(2302),c=n(3841),u=n(3861),d=n(6944),l=n(4334),f=n(9694),p=n(164),h=n(659),_=n(7510),g=n(4334),v=n(4774),E=n(5962),y=n(2193),b=o.__importDefault(n(9207)),m=(0,n(5305).getLogger)("identity");t.default=class{constructor(e,t={}){this._emitter=new i.EventEmitter,this._w=e,this._listenerOptions=t,this._fetchers=new Map,this._identities={}}add(e,t){let n,o;if("function"==typeof t)return void this._fetchers.set(e,(()=>t()));switch(t.format){case r.IdentityFormat.IDENTITY_FORMAT_JSON:n=h.structure;break;case r.IdentityFormat.IDENTITY_FORMAT_JWT:n=_.structure;break;case r.IdentityFormat.IDENTITY_FORMAT_QUERY:n=g.structure;break;case r.IdentityFormat.IDENTITY_FORMAT_SEMICOLON:n=v.structure;break;default:n=p.structure}const i=t.key||"value";switch(o=t.encoding===r.IdentityEncoding.IDENTITY_ENCODING_BASE64?E.encoding:y.encoding,t.type){case r.IdentityType.IDENTITY_TYPE_COOKIE:this._fetchers.set(e,(e=>(0,s.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;case r.IdentityType.IDENTITY_TYPE_DATA_LAYER:this._fetchers.set(e,(e=>(0,a.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;case r.IdentityType.IDENTITY_TYPE_WINDOW:this._fetchers.set(e,(e=>(0,c.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;case r.IdentityType.IDENTITY_TYPE_LOCAL_STORAGE:this._fetchers.set(e,(e=>(0,u.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;case r.IdentityType.IDENTITY_TYPE_SESSION_STORAGE:this._fetchers.set(e,(e=>(0,d.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;case r.IdentityType.IDENTITY_TYPE_QUERY_STRING:this._fetchers.set(e,(e=>(0,l.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;case r.IdentityType.IDENTITY_TYPE_MANAGED:this._fetchers.set(e,(e=>(0,f.fetcher)(e,t.variable).then((e=>o(e).map(n).map((e=>String(e[i])))))));break;default:throw new Error(`unsupported identity type ${t.type} for ${e}`)}}start(){return o.__awaiter(this,void 0,void 0,(function*(){if(!this._intervalId)return this._listenerOptions.interval&&(this._intervalId=this._w.setInterval(this.notify.bind(this),this._listenerOptions.interval),this._listenerOptions.timeout&&this._w.setTimeout(this.stop.bind(this),this._listenerOptions.timeout)),this.notify()}))}stop(){this._intervalId&&(this._w.clearInterval(this._intervalId),this._intervalId=void 0)}notify(){return o.__awaiter(this,void 0,void 0,(function*(){const e={};for(const[t,n]of this._fetchers.entries())try{const o=yield n(this._w);for(const n of o)e[t]=n}catch(e){m.warn(`failed to fetch identity for ${t}: ${e}`)}(0,b.default)(e,this._identities)||(this._emitter.emit("identity",e),this._identities=e)}))}addListener(e,t){return this.on(e,t)}on(e,t){return this._emitter.on(e,t),this}once(e,t){return this._emitter.once(e,t),this}removeListener(e,t){return this.off(e,t)}off(e,t){return this._emitter.off(e,t),this}removeAllListeners(e){return this._emitter.removeAllListeners(e),this}}},2706:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1635);t.default=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){if(!e||0===t.length)return[];try{const n=function(e,t){const n=t.split(".");let o=e,i=null;for(;n.length>0;)if("window"===n[0])n.shift();else if("object"==typeof o)"()"===n[0].slice(-2)?(i=o,o=o[n[0].slice(0,-2)]):(i=o,o=o[n.shift()]);else{if("function"!=typeof o)return null;{const e=o.call(i);i=o,o=e,n.shift()}}return o&&"string"!=typeof o&&(o=o.toString(),o.startsWith("[object"))?"":o}(e,t);return n&&"0"!==n?[n]:[]}catch(e){return[]}}))}},3841:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetcher=void 0;const o=n(1635).__importDefault(n(2706));t.fetcher=o.default},5305:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getLogLevel=t.getLogger=t.wrapLogger=t.getParams=t.DEFAULT_LOG_LEVEL=void 0;const i=o(n(9343));t.DEFAULT_LOG_LEVEL="warn";const r={trace:1,debug:2,info:3,warn:4,error:5,log:6},s=()=>{};function a(e=window.location.search,t=["ketch_","swb_"]){return new i.default(e,t)}function c(e,t){const n=`[${t}]`;return{trace:(...t)=>{e.trace(n,...t)},debug:(...t)=>{e.debug(n,...t)},info:(...t)=>{e.info(n,...t)},log:(...t)=>{e.log(n,...t)},warn:(...t)=>{e.warn(n,...t)},error:(...t)=>{e.error(n,...t)}}}function u(e=a()){const n=e.get("log");if(n&&n.length){const e=n.toLowerCase();if(e&&r[e])return e}else if(e.has("debug"))return"debug";return t.DEFAULT_LOG_LEVEL}t.getParams=a,t.wrapLogger=c,t.getLogger=function(e,t=u(a())){const o={log:n.g.console.log,error:n.g.console.error};t=t.toString().toLowerCase();for(const e of Object.keys(r))o[e]="log"===e||r[e]>=r[t]?"error"===e?o.error:o.log:s;return c(o,e)},t.getLogLevel=u},9343:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends URLSearchParams{constructor(e,t){super(e),this._prefixes=t}delete(e){for(const t of this._prefixes)super.delete(`${t}${e}`)}get(e){for(const t of this._prefixes){const n=super.get(`${t}${e}`);if(n)return n}return null}getAll(e){for(const t of this._prefixes)if(super.has(`${t}${e}`))return super.getAll(`${t}${e}`);return[]}has(e){for(const t of this._prefixes)if(super.has(`${t}${e}`))return!0;return!1}}t.default=n},7586:(e,t)=>{"use strict";var n,o,i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.FormFieldVariant=t.FormFieldType=t.FormFieldCategory=t.FormFieldWidth=void 0,(r=t.FormFieldWidth||(t.FormFieldWidth={})).UNSPECIFIED="unspecified",r.HALF="half",r.FULL="full",(i=t.FormFieldCategory||(t.FormFieldCategory={})).UNSPECIFIED="unspecified",i.DEFAULT="default",i.CUSTOM="custom",(o=t.FormFieldType||(t.FormFieldType={})).UNSPECIFIED="unspecified",o.TEXT="text",o.DROPDOWN="dropdown",o.CHECKBOX="checkbox",(n=t.FormFieldVariant||(t.FormFieldVariant={})).UNSPECIFIED="unspecified",n.INPUT="input",n.TEXTAREA="textarea"},8509:(e,t,n)=>{"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FormFieldVariant=t.FormFieldType=t.FormFieldCategory=t.FormFieldWidth=t.PreviewMessageType=t.RightsFormMode=t.CanonicalRightCode=t.SubscriptionItemType=t.UnsubscribeAllImpact=t.PreferenceCenterPage=t.QuickLinkAction=t.BannerButtonAction=t.SwitchButtonDisplay=t.FormFieldStyle=t.UnsubscribeFromAllPosition=t.SubscriptionListStyle=t.ExitButtonPosition=t.ModalContainerPosition=t.BannerContainerPosition=t.BannerContainerSize=t.BannerContainerLayout=t.ListLayout=t.ItemStyle=t.ButtonVariant=t.SubscriptionStatus=t.SubscriptionExperienceItemType=t.StorageOriginPolicy=t.ExperienceActionKind=t.ModalPosition=t.BannerPosition=t.SubscriptionControlPositionType=t.SubscriptionControlImpactType=t.SwitchTextRenderLogic=t.IdentityEncoding=t.IdentityFormat=t.IdentityType=t.CookieCategory=t.CookieProvenance=t.CookieDuration=t.MigrationOption=t.ExperiencePrimaryButtonAction=t.ExperienceButtonDestination=t.ExperienceDefault=t.SetConsentReason=t.ExperienceClosedReason=t.ConsentExperienceType=t.ExperienceDisplayType=t.ExperienceType=t.isTab=t.Tab=void 0,function(e){e.Overview="overviewTab",e.Rights="rightsTab",e.Consents="consentsTab",e.Subscriptions="subscriptionsTab"}(o=t.Tab||(t.Tab={}));const i=Object.values(o).map((e=>e.toString()));var r,s,a,c,u,d,l,f,p,h,_,g,v,E,y,b,m,C,w,T,N,O,I,S,P,L,A,R,x,D,k,j,M,F,U,V,B,H,Y,$,K,G,W,z;t.isTab=function(e){return i.includes(e)},(z=t.ExperienceType||(t.ExperienceType={})).Consent="experiences.consent",z.Preference="experiences.preference",(W=t.ExperienceDisplayType||(t.ExperienceDisplayType={})).Banner="experiencedisplays.banner",W.Modal="experiencedisplays.modal",W.Preference="experiencedisplays.preference",(G=t.ConsentExperienceType||(t.ConsentExperienceType={})).Banner="experiences.consent.banner",G.Modal="experiences.consent.modal",G.JIT="experiences.consent.jit",(K=t.ExperienceClosedReason||(t.ExperienceClosedReason={})).SET_CONSENT="setConsent",K.INVOKE_RIGHT="invokeRight",K.CLOSE="close",K.CLOSE_WITHOUT_SETTING_CONSENT="closeWithoutSettingConsent",K.WILL_NOT_SHOW="willNotShow",K.SET_SUBSCRIPTIONS="setSubscriptions",($=t.SetConsentReason||(t.SetConsentReason={})).USER_UPDATE="userUpdate",$.USER_EXPERIENCE_DISMISSAL="userExperienceDismissal",$.DEFAULT_STATE="defaultState",(Y=t.ExperienceDefault||(t.ExperienceDefault={}))[Y.BANNER=1]="BANNER",Y[Y.MODAL=2]="MODAL",(H=t.ExperienceButtonDestination||(t.ExperienceButtonDestination={}))[H.GOTO_MODAL=1]="GOTO_MODAL",H[H.GOTO_PREFERENCE=2]="GOTO_PREFERENCE",H[H.REJECT_ALL=3]="REJECT_ALL",(B=t.ExperiencePrimaryButtonAction||(t.ExperiencePrimaryButtonAction={}))[B.SAVE_CURRENT_STATE=1]="SAVE_CURRENT_STATE",B[B.ACCEPT_ALL=2]="ACCEPT_ALL",(V=t.MigrationOption||(t.MigrationOption={}))[V.MIGRATE_DEFAULT=0]="MIGRATE_DEFAULT",V[V.MIGRATE_NEVER=1]="MIGRATE_NEVER",V[V.MIGRATE_FROM_ALLOW=2]="MIGRATE_FROM_ALLOW",V[V.MIGRATE_FROM_DENY=3]="MIGRATE_FROM_DENY",V[V.MIGRATE_ALWAYS=4]="MIGRATE_ALWAYS",(U=t.CookieDuration||(t.CookieDuration={}))[U.SESSION=1]="SESSION",U[U.PERSISTENT=2]="PERSISTENT",(F=t.CookieProvenance||(t.CookieProvenance={}))[F.FIRST_PARTY=1]="FIRST_PARTY",F[F.THIRD_PARTY=2]="THIRD_PARTY",(M=t.CookieCategory||(t.CookieCategory={}))[M.STRICTLY_NECESSARY=1]="STRICTLY_NECESSARY",M[M.FUNCTIONAL=2]="FUNCTIONAL",M[M.PERFORMANCE=3]="PERFORMANCE",M[M.MARKETING=4]="MARKETING",(j=t.IdentityType||(t.IdentityType={})).IDENTITY_TYPE_UNDEFINED="",j.IDENTITY_TYPE_DATA_LAYER="dataLayer",j.IDENTITY_TYPE_WINDOW="window",j.IDENTITY_TYPE_COOKIE="cookie",j.IDENTITY_TYPE_MANAGED="managedCookie",j.IDENTITY_TYPE_LOCAL_STORAGE="localStorage",j.IDENTITY_TYPE_SESSION_STORAGE="sessionStorage",j.IDENTITY_TYPE_QUERY_STRING="queryString",(k=t.IdentityFormat||(t.IdentityFormat={})).IDENTITY_FORMAT_UNDEFINED="",k.IDENTITY_FORMAT_STRING="string",k.IDENTITY_FORMAT_JSON="json",k.IDENTITY_FORMAT_JWT="jwt",k.IDENTITY_FORMAT_QUERY="query",k.IDENTITY_FORMAT_SEMICOLON="semicolon",(D=t.IdentityEncoding||(t.IdentityEncoding={})).IDENTITY_ENCODING_UNDEFINED="",D.IDENTITY_ENCODING_NONE="none",D.IDENTITY_ENCODING_BASE64="base64",(x=t.SwitchTextRenderLogic||(t.SwitchTextRenderLogic={}))[x.SWITCH_TEXT_RENDER_ALL=1]="SWITCH_TEXT_RENDER_ALL",x[x.SWITCH_TEXT_RENDER_LEGAL_BASIS=2]="SWITCH_TEXT_RENDER_LEGAL_BASIS",x[x.SWITCH_TEXT_RENDER_CHANGE=3]="SWITCH_TEXT_RENDER_CHANGE",x[x.SWITCH_TEXT_RENDER_NEVER=4]="SWITCH_TEXT_RENDER_NEVER",(R=t.SubscriptionControlImpactType||(t.SubscriptionControlImpactType={}))[R.UNSPECIFIED=0]="UNSPECIFIED",R[R.GLOBAL=1]="GLOBAL",R[R.LOCAL=2]="LOCAL",(A=t.SubscriptionControlPositionType||(t.SubscriptionControlPositionType={}))[A.UNSPECIFIED=0]="UNSPECIFIED",A[A.TOP=1]="TOP",A[A.BOTTOM=2]="BOTTOM",(L=t.BannerPosition||(t.BannerPosition={}))[L.BOTTOM=1]="BOTTOM",L[L.TOP=2]="TOP",L[L.BOTTOM_LEFT=3]="BOTTOM_LEFT",L[L.BOTTOM_RIGHT=4]="BOTTOM_RIGHT",(P=t.ModalPosition||(t.ModalPosition={}))[P.CENTER=1]="CENTER",P[P.LEFT_FULL_HEIGHT=2]="LEFT_FULL_HEIGHT",P[P.RIGHT_FULL_HEIGHT=3]="RIGHT_FULL_HEIGHT",(S=t.ExperienceActionKind||(t.ExperienceActionKind={}))[S.ShowExperience=0]="ShowExperience",S[S.HideExperience=1]="HideExperience",S[S.SetConsent=2]="SetConsent",S[S.SetSubscription=3]="SetSubscription",S[S.InvokeRight=4]="InvokeRight",(I=t.StorageOriginPolicy||(t.StorageOriginPolicy={})).CrossOrigin="cross-origin",I.SameOrigin="same-origin,",(O=t.SubscriptionExperienceItemType||(t.SubscriptionExperienceItemType={}))[O.SUBSCRIPTION_EXPERIENCE_ITEM_TYPE_UNKNOWN=0]="SUBSCRIPTION_EXPERIENCE_ITEM_TYPE_UNKNOWN",O[O.SUBSCRIPTION_EXPERIENCE_ITEM_TYPE_TOPIC=1]="SUBSCRIPTION_EXPERIENCE_ITEM_TYPE_TOPIC",O[O.SUBSCRIPTION_EXPERIENCE_ITEM_TYPE_CONTROL=2]="SUBSCRIPTION_EXPERIENCE_ITEM_TYPE_CONTROL",(N=t.SubscriptionStatus||(t.SubscriptionStatus={})).Denied="denied",N.Granted="granted",(T=t.ButtonVariant||(t.ButtonVariant={})).Outlined="outlined",T.Contained="contained",(w=t.ItemStyle||(t.ItemStyle={})).Filled="filled",w.Outlined="outlined",(C=t.ListLayout||(t.ListLayout={})).Expandable="expandable",C.Cards="cards",(m=t.BannerContainerLayout||(t.BannerContainerLayout={})).Horizontal="horizontal",m.Vertical="vertical",m.Centered="centered",(b=t.BannerContainerSize||(t.BannerContainerSize={})).Standard="standard",b.Compact="compact",(y=t.BannerContainerPosition||(t.BannerContainerPosition={})).Bottom="bottom",y.Top="top",y.LeftCorner="leftCorner",y.RightCorner="rightCorner",y.BottomMiddle="bottomMiddle",y.Center="center",(E=t.ModalContainerPosition||(t.ModalContainerPosition={})).Center="center",E.Left="left",E.Right="right",(v=t.ExitButtonPosition||(t.ExitButtonPosition={})).topRight="topRight",v.bottomLeft="bottomLeft",(g=t.SubscriptionListStyle||(t.SubscriptionListStyle={})).Filled="filled",g.Underlined="underlined",(_=t.UnsubscribeFromAllPosition||(t.UnsubscribeFromAllPosition={})).Top="top",_.Bottom="bottom",(h=t.FormFieldStyle||(t.FormFieldStyle={})).Box="box",h.Underline="underline",(p=t.SwitchButtonDisplay||(t.SwitchButtonDisplay={})).Always="always",p.WhenLegalBasisDiffers="whenLegalBasisDiffers",(f=t.BannerButtonAction||(t.BannerButtonAction={})).SaveCurrentState="saveCurrentState",f.AcceptAll="acceptAll",f.OpenModal="openModal",f.OpenPreferences="openPreferences",f.RejectAll="rejectAll",f.OpenURL="openURL",(l=t.QuickLinkAction||(t.QuickLinkAction={})).OpenUrl="openUrl",l.OpenPage="openPage",(d=t.PreferenceCenterPage||(t.PreferenceCenterPage={})).Welcome="welcome",d.PrivacyPolicy="privacyPolicy",d.Purpose="purpose",d.Subscriptions="subscriptions",d.RequestsHome="requestsHome",d.RequestsForm="requestsForm",d.RequestsSubmitted="requestsSubmitted",(u=t.UnsubscribeAllImpact||(t.UnsubscribeAllImpact={})).Universal="universal",u.SingleExperience="singleExperience",(c=t.SubscriptionItemType||(t.SubscriptionItemType={})).Unknown="unknown",c.Topic="topic",c.Control="control",(a=t.CanonicalRightCode||(t.CanonicalRightCode={})).Get="get",a.Delete="delete",a.Restrict="restrict",a.Update="update",(s=t.RightsFormMode||(t.RightsFormMode={})).Single="single",s.Custom="custom",(r=t.PreviewMessageType||(t.PreviewMessageType={})).LoadConfig="loadConfig",r.ShowBanner="showBanner",r.ShowModal="showModal",r.ShowPreference="showPreferences",r.SwitchPreferencePage="switchPreferencePage";var X=n(7586);Object.defineProperty(t,"FormFieldWidth",{enumerable:!0,get:function(){return X.FormFieldWidth}}),Object.defineProperty(t,"FormFieldCategory",{enumerable:!0,get:function(){return X.FormFieldCategory}}),Object.defineProperty(t,"FormFieldType",{enumerable:!0,get:function(){return X.FormFieldType}}),Object.defineProperty(t,"FormFieldVariant",{enumerable:!0,get:function(){return X.FormFieldVariant}})},1635:(e,t,n)=>{"use strict";n.r(t),n.d(t,{__addDisposableResource:()=>D,__assign:()=>r,__asyncDelegator:()=>N,__asyncGenerator:()=>T,__asyncValues:()=>O,__await:()=>w,__awaiter:()=>h,__classPrivateFieldGet:()=>A,__classPrivateFieldIn:()=>x,__classPrivateFieldSet:()=>R,__createBinding:()=>g,__decorate:()=>a,__disposeResources:()=>j,__esDecorate:()=>u,__exportStar:()=>v,__extends:()=>i,__generator:()=>_,__importDefault:()=>L,__importStar:()=>P,__makeTemplateObject:()=>I,__metadata:()=>p,__param:()=>c,__propKey:()=>l,__read:()=>y,__rest:()=>s,__runInitializers:()=>d,__setFunctionName:()=>f,__spread:()=>b,__spreadArray:()=>C,__spreadArrays:()=>m,__values:()=>E,default:()=>M});var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function s(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}function a(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,o){t(n,o,e)}}function u(e,t,n,o,i,r){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,c=o.kind,u="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?o.static?e:e.prototype:null,l=t||(d?Object.getOwnPropertyDescriptor(d,o.name):{}),f=!1,p=n.length-1;p>=0;p--){var h={};for(var _ in o)h[_]="access"===_?{}:o[_];for(var _ in o.access)h.access[_]=o.access[_];h.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");r.push(s(e||null))};var g=(0,n[p])("accessor"===c?{get:l.get,set:l.set}:l[u],h);if("accessor"===c){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(a=s(g.get))&&(l.get=a),(a=s(g.set))&&(l.set=a),(a=s(g.init))&&i.unshift(a)}else(a=s(g))&&("field"===c?i.unshift(a):l[u]=a)}d&&Object.defineProperty(d,o.name,l),f=!0}function d(e,t,n){for(var o=arguments.length>2,i=0;i<t.length;i++)n=o?t[i].call(e,n):t[i].call(e);return o?n:void 0}function l(e){return"symbol"==typeof e?e:"".concat(e)}function f(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function _(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var g=Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]};function v(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||g(t,e,n)}function E(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return s}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function m(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)o[i]=r[s];return o}function C(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))}function w(e){return this instanceof w?(this.v=e,this):new w(e)}function T(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=n.apply(e,t||[]),r=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(e){i[e]&&(o[e]=function(t){return new Promise((function(n,o){r.push([e,t,n,o])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof w?Promise.resolve(n.value.v).then(c,u):d(r[0][2],n)}catch(e){d(r[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}function N(e){var t,n;return t={},o("next"),o("throw",(function(e){throw e})),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,i){t[o]=e[o]?function(t){return(n=!n)?{value:w(e[o](t)),done:!1}:i?i(t):t}:i}}function O(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=E(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,i){!function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)}(o,i,(t=e[n](t)).done,t.value)}))}}}function I(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var S=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&g(t,e,n);return S(t,e),t}function L(e){return e&&e.__esModule?e:{default:e}}function A(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}function R(e,t,n,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(e,n):i?i.value=n:t.set(e,n),n}function x(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function D(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose]}if("function"!=typeof o)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t}var k="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o};function j(e){function t(t){e.error=e.hasError?new k(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function n(){for(;e.stack.length;){var o=e.stack.pop();try{var i=o.dispose&&o.dispose.call(o.value);if(o.async)return Promise.resolve(i).then(n,(function(e){return t(e),n()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}const M={__extends:i,__assign:r,__rest:s,__decorate:a,__param:c,__metadata:p,__awaiter:h,__generator:_,__createBinding:g,__exportStar:v,__values:E,__read:y,__spread:b,__spreadArrays:m,__spreadArray:C,__await:w,__asyncGenerator:T,__asyncDelegator:N,__asyncValues:O,__makeTemplateObject:I,__importStar:P,__importDefault:L,__classPrivateFieldGet:A,__classPrivateFieldSet:R,__classPrivateFieldIn:x,__addDisposableResource:D,__disposeResources:j}},8163:e=>{"use strict";e.exports={version:"0.0.0"}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";const e=n(1635),t=n(549),o=e.__importDefault(n(5307));window.semaphore=window.semaphore||[],window.semaphore.push(["registerPlugin",o.default]),(0,t.boot)()})()})();

}
/*
     FILE ARCHIVED ON 08:39:57 Nov 06, 2024 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 20:20:57 Dec 01, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 0.565
  exclusion.robots: 0.018
  exclusion.robots.policy: 0.008
  esindex: 0.011
  cdx.remote: 19.438
  LoadShardBlock: 207.56 (6)
  PetaboxLoader3.datanode: 179.046 (8)
  PetaboxLoader3.resolve: 179.807 (3)
  load_resource: 280.73 (2)
*/